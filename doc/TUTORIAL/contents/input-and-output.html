<!-- beg of [input-and-output.html] -->

<H2><A id="input-and-output" name="input-and-output">Input and
Output</A></H2>

<HR SIZE=1 ALIGN=LEFT><P>

The I/O is done in ATS/Anairiats by providing interfaces for various I/O
functions in C. In particular, most functions declared in &lt;stdio.h&gt;
have their counterparts declared in <a
href="http://www.ats-lang.org/IMPLEMENTATION/Anairiats/ATS/libc/SATS/stdio.sats">libc/SATS/stdio.sats</a>.
<P>

There is a datasort <i>file_mode</i> and an abstract type constructor
<i>FILE</i> in ATS that are declared as follows:

<pre>
datasort file_mode =
  | file_mode_r | file_mode_w | file_mode_rw

absviewt@ype FILE (file_mode) = $extype "ats_FILE_type"
</pre>

where the external type <i>ats_FILE_type</i> is an alias of the type
<i>FILE</i> in C. We now use <i>r</i>, <i>w</i> and <i>rw</i> for
<i>file_mode_r</i>, <i>file_mode_w</i> and <i>file_mode_rw</i> in the
following presentation.

If a file is assigned the type <i>FILE(r)</i>, then it is read-only; if it
is assigned the type <i>FILE(w)</i>, then it is write-only; it is assigned
the type <i>FILE(rw)</i>, then it can be read from and also written to.
<P>

There is also an abstract type constructor<i>file_mode</i> declared as
follows:

<pre>
abst@ype file_mode (file_mode)
</pre>

Note that <i>file_mode</i> is overloaded: it refers to a type constructor
as well as a datasort. The following values are available that represent
various file modes:

<pre>
val file_mode_r : file_mode (r) // = "r"
val file_mode_rr : file_mode (rw) // = "r+"
val file_mode_w : file_mode (w) // = "w"
val file_mode_ww : file_mode (rw) // = "w+"
val file_mode_a : file_mode (w) // = "a"
val file_mode_aa : file_mode (rw) // = "a+"
</pre>
<P>

<H4>Opening a File</H4>
The function <i>fopen</i> in C is for opening a file of a given name. In
ATS, there is a function <i>fopen_exn</i> that is assigned the following type:
<pre>
fun fopen_exn {m:file_mode}
  (path: string, m: file_mode m): [l:addr] (FILE m @ l | ptr l)
</pre>
Note that we use
<i>_exn</i> in the name of <i>fopen_exn</i> as a convention to indicate
that an exception is raised if a call to this function results in an error.
There is another function
<i>fopen_err</i> in ATS that is assigned the following type:

<pre>
fun fopen_err {m:file_mode}
  (path: string, m: file_mode m): [l:addr] (FILE_opt_v (m, l) | ptr l)
</pre>

where <i>FILE_opt_v (m, l)</i> is defined as follows:

<pre>
viewdef FILE_opt_v (m:file_mode, l:addr) = option_v (FILE m @ l, l <> null)
</pre>

The function <i>fopen_err</i> exactly corresponds to <i>fopen</i> in C: It
returns a null pointer in case of error.
<P>

<H4>Closing a File</H4>
The function <i>fclose</i> in C is for closing an opened file. In ATS,
there is a function <i>fclose_exn</i> that is assigned the following type:

<pre>
fun fclose_exn {m:file_mode} {l:addr} (pf: FILE m @ l | p: ptr l): void
</pre>

The function <i>fclose_exn</i> raises an exception if a call to it results
in an error. There is another function
<i>fclose_err</i> that is assigned the following type:

<pre>
fun fclose_exn {m:file_mode} {l:addr} (pf: FILE m @ l | p: ptr l): int
</pre>

The function <i>fclose_err</i> exactly corresponds to <i>fclose</i> in C: It
returns 0 in case of success and EOF in case of error.

<H4>Reading from a File</H4>
The function <i>fgetc</i> in C is for reading a character from an opened file. In
ATS, there is a function <i>fget_err</i> that is assigned the following type:

<pre>
fun fgetc_err {m:file_mode}
  (pf: file_mode_lte (m, r) | f: &FILE m): [i:int | i <= UCHAR_MAX] int i
</pre>

where <i>UCHAR_MAX</i> is defined to be 255.
This function exactly corresponds to
<i>fgetc</i> in C: It returns the obtained character (cast into <i>unsigned
char</i>) if successful, or it returns EOF in case of failure.  The file
argument of the function <i>fgets_err</i>, i.e., its first non-proof argument,
is passed as a reference (call-by-reference).
<P>

Note that <i>file_mode_lte</i> is a prop constructor. Given two file modes
<i>m1</i> and <i>m2</i>, if a proof of the prop
<i>file_mode_lte (m1, m2)</i> can be formed, then <i>m1</i> is less than or
equal to <i>m2</i>. The following proofs are available:

<pre>
prval file_mode_lte_r_r : file_mode_lte (r, r)
prval file_mode_lte_rw_r : file_mode_lte (rw, r)
prval file_mode_lte_w_w : file_mode_lte (w, w)
prval file_mode_lte_rw_w : file_mode_lte (rw, w)
prval file_mode_lte_rw_rw : file_mode_lte (rw, rw)
</pre>

In order to read from a file of the type <i>FILE (m)</i>, it is necessary
to prove that <i>m</i> is less than or equal to <i>r</i>.
<P>

There is currently no function <i>fget_exn</i>, which would be given the
following type if defined:

<pre>
fun fgetc_exn {m:file_mode}
  (pf: file_mode_lte (m, r) | f: &FILE m): [i:nat | i <= UCHAR_MAX] int i
</pre>

The problem with <i>fgetc_exn</i> is that it is not a function of much
use. If implemented, this function should probably be called on a file
after it is made certain (e.g., by calling <i>feof</i>) that the file has
not reached its end.

<H4>Writing to a File</H4>

The function <i>fputc</i> in C is for writing a character into a file. In
ATS, there is a function <i>fputc_err</i> that is assigned the following type:

<pre>
fun fputc_err {m:file_mode}
  (pf: file_mode_lte (m, w) | c: char, f: &FILE m): [i:int | i <= UCHAR_MAX] int i
</pre>

This function exactly corresponds to <i>fputc</i> in C: It returns the
charater being written in case of success, or EOF in case of failure. There
is another function <i>fputc_exn</i> that is assigned the following type:

<pre>
fun fputc_exn {m:file_mode} (pf: file_mode_lte (m, w) | c: char, f: &FILE m): void
</pre>

In case of failure, <i>fputs_exn</i> raises an exception.

<H4>An Example: Concatenating Files</H4>

The following function <i>filecopy_exn</i> copies a file into another one:

<PRE><FONT COLOR="#E80000"><FONT COLOR="#000000">fn</FONT> filecopy_exn <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>m1<FONT COLOR="#000000">,</FONT>m2<FONT COLOR="#000000">:</FONT>file_mode<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>
    <FONT COLOR="#009000">pf1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">file_mode_lte <FONT COLOR="#000000">(</FONT>m1<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">)</FONT></FONT></FONT>
  <FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">pf2<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">file_mode_lte <FONT COLOR="#000000">(</FONT>m2<FONT COLOR="#000000">,</FONT> w<FONT COLOR="#000000">)</FONT></FONT></FONT>
  <FONT COLOR="#000000">|</FONT> fil_s<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">&amp;</FONT>FILE m1</FONT><FONT COLOR="#000000">,</FONT> fil_d<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">&amp;</FONT>FILE m2</FONT>
  <FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">fun</FONT> loop
    <FONT COLOR="#000000">(</FONT>fil_s<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">&amp;</FONT>FILE m1</FONT><FONT COLOR="#000000">,</FONT> fil_d<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">&amp;</FONT>FILE m2</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
    <FONT COLOR="#000000">val</FONT> c <FONT COLOR="#000000">=</FONT> fgetc_err <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf1</FONT> <FONT COLOR="#000000">|</FONT> fil_s<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">in</FONT>
    <FONT COLOR="#000000">if</FONT> c &gt;= 0 <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">begin</FONT>
      fputc_exn <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf2</FONT> <FONT COLOR="#000000">|</FONT> i2c c<FONT COLOR="#000000">,</FONT> fil_d<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT> loop <FONT COLOR="#000000">(</FONT>fil_s<FONT COLOR="#000000">,</FONT> fil_d<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [if]
</FONT>  <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [loop]
</FONT><FONT COLOR="#000000">in</FONT>
  loop <FONT COLOR="#000000">(</FONT>fil_s<FONT COLOR="#000000">,</FONT> fil_d<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [filecopy_exn]
</FONT>
</FONT></PRE>

In case of error, <i>filecopy_exn</i> raises an exception.


The following function <i>filecopy_err</i> is a variant of
<i>filecopy_exn</i>. Instead of raising an exception in case of error,
<i>filecopy_err</i> returns EOF.

<PRE><FONT COLOR="#E80000">
<FONT COLOR="#000000">fn</FONT> filecopy_err <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>m1<FONT COLOR="#000000">,</FONT>m2<FONT COLOR="#000000">:</FONT>file_mode<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>
    <FONT COLOR="#009000">pf1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">file_mode_lte <FONT COLOR="#000000">(</FONT>m1<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">)</FONT></FONT></FONT>
  <FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">pf2<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">file_mode_lte <FONT COLOR="#000000">(</FONT>m2<FONT COLOR="#000000">,</FONT> w<FONT COLOR="#000000">)</FONT></FONT></FONT>
  <FONT COLOR="#000000">|</FONT> fil_s<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">&amp;</FONT>FILE m1</FONT><FONT COLOR="#000000">,</FONT> fil_d<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">&amp;</FONT>FILE m2</FONT>
  <FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">fun</FONT> loop
    <FONT COLOR="#000000">(</FONT>fil_s<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">&amp;</FONT>FILE m1</FONT><FONT COLOR="#000000">,</FONT> fil_d<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">&amp;</FONT>FILE m2</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
    <FONT COLOR="#000000">val</FONT> c <FONT COLOR="#000000">=</FONT> fgetc_err <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf1</FONT> <FONT COLOR="#000000">|</FONT> fil_s<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">in</FONT>
    <FONT COLOR="#000000">if</FONT> c &gt;= 0 <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val</FONT> err <FONT COLOR="#000000">=</FONT> fputc_err <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf2</FONT> <FONT COLOR="#000000">|</FONT> i2c c<FONT COLOR="#000000">,</FONT> fil_d<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
      loop <FONT COLOR="#000000">(</FONT>fil_s<FONT COLOR="#000000">,</FONT> fil_d<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [if]
</FONT>  <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [loop]
</FONT>  <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> loop <FONT COLOR="#000000">(</FONT>fil_s<FONT COLOR="#000000">,</FONT> fil_d<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">in</FONT>
  <FONT COLOR="#000000">if</FONT> ferror <FONT COLOR="#000000">(</FONT>fil_d<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> 0 <FONT COLOR="#000000">then</FONT> ~1 <FONT COLOR="#000000">else</FONT> 0
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [filecopy_err]
</FONT>
</FONT></PRE>

We now use <i>filecopy_err</i> to implement as follows the functionality of
concatenating a list of files into a single one:

<PRE><FONT COLOR="#E80000">
<FONT COLOR="#000000">implement</FONT> main <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>argc<FONT COLOR="#000000">,</FONT> argv<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">case+</FONT> argc <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> 1 <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf_stdin</FONT> <FONT COLOR="#000000">|</FONT> p_stdin<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> stdin_get <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf_stdout</FONT> <FONT COLOR="#000000">|</FONT> p_stdout<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> stdout_get <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">val</FONT> _<FONT COLOR="#787878">(*err*)</FONT> <FONT COLOR="#000000">=</FONT> filecopy_err
        <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">file_mode_lte_r_r</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">file_mode_lte_w_w</FONT> <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">!</FONT>p_stdin<FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">!</FONT>p_stdout<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> stdout_view_set <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf_stdout</FONT> <FONT COLOR="#000000">|</FONT> <FONT COLOR="#787878">(*none*)</FONT><FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> stdin_view_set <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf_stdin</FONT> <FONT COLOR="#000000">|</FONT> <FONT COLOR="#787878">(*none*)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
      <FONT COLOR="#787878">// empty
</FONT>    <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [1]
</FONT>  <FONT COLOR="#000000">|</FONT> _ <FONT COLOR="#787878">(*argc &gt;= 2*)</FONT> <FONT COLOR="#000000">=&gt;</FONT> loop <FONT COLOR="#000000">(</FONT>argc<FONT COLOR="#000000">,</FONT> argv<FONT COLOR="#000000">,</FONT> 1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">where</FONT> <FONT COLOR="#000000">{</FONT>
      <FONT COLOR="#000000">fun</FONT> loop <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>i<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> i &lt;= n<FONT COLOR="#000000">}</FONT></FONT>
        <FONT COLOR="#000000">(</FONT>argc<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int n</FONT><FONT COLOR="#000000">,</FONT> argv<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">&amp;</FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">@[</FONT>string<FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int i</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT>
        <FONT COLOR="#000000">if</FONT> i <FONT COLOR="#000000">&lt;</FONT> argc <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">let</FONT>
          <FONT COLOR="#000000">val</FONT> name <FONT COLOR="#000000">=</FONT> argv<FONT COLOR="#000000">.</FONT><FONT COLOR="#000000">[</FONT><FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT>
          <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pfopt</FONT> <FONT COLOR="#000000">|</FONT> p_ifp<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> fopen_err <FONT COLOR="#000000">(</FONT>name<FONT COLOR="#000000">,</FONT> file_mode_r<FONT COLOR="#000000">)</FONT>
        <FONT COLOR="#000000">in</FONT>
          <FONT COLOR="#000000">if</FONT> p_ifp &lt;&gt; null <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">let</FONT>
            <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">Some_v <FONT COLOR="#000000">(</FONT>pf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> pfopt</FONT>
            <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf_stdout</FONT> <FONT COLOR="#000000">|</FONT> p_stdout<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> stdout_get <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
            <FONT COLOR="#000000">val</FONT> _<FONT COLOR="#787878">(*err*)</FONT> <FONT COLOR="#000000">=</FONT> filecopy_err
              <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">file_mode_lte_r_r</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">file_mode_lte_w_w</FONT> <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">!</FONT>p_ifp<FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">!</FONT>p_stdout<FONT COLOR="#000000">)</FONT>
            <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> stdout_view_set <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf_stdout</FONT> <FONT COLOR="#000000">|</FONT> <FONT COLOR="#787878">(*none*)</FONT><FONT COLOR="#000000">)</FONT>
            <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> fclose_exn <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> p_ifp<FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">in</FONT>
            loop <FONT COLOR="#000000">(</FONT>argc<FONT COLOR="#000000">,</FONT> argv<FONT COLOR="#000000">,</FONT> i+1<FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">end</FONT> <FONT COLOR="#000000">else</FONT> <FONT COLOR="#000000">let</FONT>
            <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">None_v <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> pfopt</FONT>
            <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> prerrf <FONT COLOR="#000000">(</FONT>"%s: can't open [%s]\n"<FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">@(</FONT>argv<FONT COLOR="#000000">.</FONT><FONT COLOR="#000000">[</FONT><FONT COLOR="#009000">0</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">,</FONT> name<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">in</FONT>
            exit <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>void<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>1<FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [if]
</FONT>        <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [if]
</FONT>    <FONT COLOR="#000000">}</FONT> <FONT COLOR="#787878">// end of [_]
</FONT>  <FONT COLOR="#787878">// end of [val]
</FONT>  <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf_stdout</FONT> <FONT COLOR="#000000">|</FONT> p_stdout<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> stdout_get <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">val</FONT> err <FONT COLOR="#000000">=</FONT> ferror <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">!</FONT>p_stdout<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> stdout_view_set <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf_stdout</FONT> <FONT COLOR="#000000">|</FONT> <FONT COLOR="#787878">(*none*)</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">in</FONT>
  <FONT COLOR="#000000">if</FONT> <FONT COLOR="#000000">(</FONT>err &lt;&gt; 0<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">begin</FONT>
    prerrf <FONT COLOR="#000000">(</FONT>"%s: error writing stdout\n"<FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">@(</FONT>argv<FONT COLOR="#000000">.</FONT><FONT COLOR="#000000">[</FONT><FONT COLOR="#009000">0</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT> exit <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>void<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>2<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">end</FONT> <FONT COLOR="#000000">else</FONT> <FONT COLOR="#000000">begin</FONT>
    exit <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>void<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>0<FONT COLOR="#000000">)</FONT> <FONT COLOR="#787878">// exit normally
</FONT>  <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [if]
</FONT><FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [main]
</FONT>
</FONT></PRE>

<HR SIZE=1 ALIGN=LEFT><P>
The code used for illustration is available
<a href="input-and-output.dats">here</a>.

<!-- end of [input-and-output.html] -->
