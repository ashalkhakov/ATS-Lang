<BODY BGCOLOR="#E0E0E0" TEXT="#E80000"><PRE><FONT COLOR="#787878">//
</FONT><FONT COLOR="#787878">// simply typed lambda calculus is strongly-normalizing
</FONT><FONT COLOR="#787878">// This formalization uses first-order abstract syntax for lambda-terms.
</FONT><FONT COLOR="#787878">// There are several unproven lemmas, which can certainly be finished
</FONT><FONT COLOR="#787878">// but require significant effort that is uninspiring and tedious.
</FONT><FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#787878">// April 2006:
</FONT><FONT COLOR="#787878">// The code is written by Kevin Donnelly and Hongwei Xi.
</FONT>
<FONT COLOR="#787878">// January 2007:
</FONT><FONT COLOR="#787878">// The code is ported to ATS/Geizella by Hongwei Xi
</FONT>
<FONT COLOR="#787878">// March 3rd, 2008
</FONT><FONT COLOR="#787878">// It is ported to ATS/Anairiats by Hongwei Xi
</FONT>
<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">tm <FONT COLOR="#000000">=</FONT> tmvar <FONT COLOR="#000000">of</FONT> int <FONT COLOR="#000000">|</FONT> tmlam <FONT COLOR="#000000">of</FONT> tm <FONT COLOR="#000000">|</FONT> tmapp <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">ISE <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> ISE <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmapp <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">tmshi <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">i<FONT COLOR="#000000">,</FONT>l<FONT COLOR="#000000">:</FONT>nat</FONT> <FONT COLOR="#000000">|</FONT> <FONT COLOR="#0000FF">i &gt;= l</FONT><FONT COLOR="#000000">}</FONT> TMSHIvargte <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmvar i<FONT COLOR="#000000">,</FONT> tmvar <FONT COLOR="#000000">(</FONT>i+1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> l<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">i<FONT COLOR="#000000">,</FONT>l<FONT COLOR="#000000">:</FONT>nat</FONT> <FONT COLOR="#000000">|</FONT> <FONT COLOR="#0000FF">i <FONT COLOR="#000000">&lt;</FONT> l</FONT><FONT COLOR="#000000">}</FONT> TMSHIvarlt <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmvar i<FONT COLOR="#000000">,</FONT> tmvar i<FONT COLOR="#000000">,</FONT> l<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">l<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      TMSHIlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmlam t<FONT COLOR="#000000">,</FONT> tmlam t'<FONT COLOR="#000000">,</FONT> l<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">tmshi <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">,</FONT> l+1<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>t1'<FONT COLOR="#000000">,</FONT>t2'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">l<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      TMSHIapp <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmapp <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> tmapp <FONT COLOR="#000000">(</FONT>t1'<FONT COLOR="#000000">,</FONT> t2'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> l<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmshi <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t1'<FONT COLOR="#000000">,</FONT> l<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> tmshi <FONT COLOR="#000000">(</FONT>t2<FONT COLOR="#000000">,</FONT> t2'<FONT COLOR="#000000">,</FONT> l<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">tms <FONT COLOR="#000000">=</FONT> tmsnil <FONT COLOR="#000000">|</FONT> tmsmore <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tms<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">subshi <FONT COLOR="#000000">(</FONT>tms<FONT COLOR="#000000">,</FONT> tms<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> SUBSHInil <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmsnil<FONT COLOR="#000000">,</FONT> tmsnil<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">,</FONT>ts'<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT>
      SUBSHImore <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmsmore <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> tmsmore <FONT COLOR="#000000">(</FONT>ts'<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>subshi <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> ts'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> tmshi <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">TMI <FONT COLOR="#000000">(</FONT>int<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">,</FONT> tms<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> TMIone <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>0<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> tmsmore <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">i<FONT COLOR="#000000">:</FONT>int</FONT> <FONT COLOR="#000000">|</FONT> <FONT COLOR="#0000FF">i <FONT COLOR="#000000">&gt;</FONT> 0</FONT><FONT COLOR="#000000">}</FONT>
      TMIshi <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> tmsmore <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">TMI <FONT COLOR="#000000">(</FONT>i-1<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> ts<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">subst <FONT COLOR="#000000">(</FONT>tms<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">i<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> SUBvar <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> tmvar i<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">TMI <FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> ts<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">,</FONT>ts'<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT>
      SUBlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> tmlam t<FONT COLOR="#000000">,</FONT> tmlam t'<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>subshi <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> ts'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> subst <FONT COLOR="#000000">(</FONT>tmsmore <FONT COLOR="#000000">(</FONT>ts'<FONT COLOR="#000000">,</FONT> tmvar 0<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>t1'<FONT COLOR="#000000">,</FONT>t2'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT>
      SUBapp <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> tmapp <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> tmapp <FONT COLOR="#000000">(</FONT>t1'<FONT COLOR="#000000">,</FONT> t2'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>subst <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">,</FONT> t1'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> subst <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">,</FONT> t2'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">subst1 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">,</FONT> t3<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> subst <FONT COLOR="#000000">(</FONT>tmsmore <FONT COLOR="#000000">(</FONT>tmsnil<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">,</FONT> t3<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">tp <FONT COLOR="#000000">=</FONT> tpbas <FONT COLOR="#000000">|</FONT> tpfun <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">tps <FONT COLOR="#000000">=</FONT> tpsnil <FONT COLOR="#000000">|</FONT> tpsmore <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tps<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">TP <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> 
  <FONT COLOR="#000000">|</FONT> TPbas <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tpbas<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      TPfun <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tpfun <FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n1+n2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TP <FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT> n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> TP <FONT COLOR="#000000">(</FONT>T2<FONT COLOR="#000000">,</FONT> n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">TP0 <FONT COLOR="#000000">(</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> TP <FONT COLOR="#000000">(</FONT>T<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">TPI <FONT COLOR="#000000">(</FONT>int<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">,</FONT> tps<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>tps</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> TPIone <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>0<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> tpsmore <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>tps</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">,</FONT>T'<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">i<FONT COLOR="#000000">:</FONT>int</FONT> <FONT COLOR="#000000">|</FONT> <FONT COLOR="#0000FF">i <FONT COLOR="#000000">&gt;</FONT> 0</FONT><FONT COLOR="#000000">}</FONT>
      TPIshi <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> tpsmore <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> T'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">TPI <FONT COLOR="#000000">(</FONT>i-1<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> G<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">DER <FONT COLOR="#000000">(</FONT>tps<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>tps</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">i<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> DERvar <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> tmvar i<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">TPI <FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> G<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>tps</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">s<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      DERlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> tmlam t<FONT COLOR="#000000">,</FONT> tpfun <FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> s+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">DER <FONT COLOR="#000000">(</FONT>tpsmore <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">,</FONT> s<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>tps</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">s1<FONT COLOR="#000000">,</FONT>s2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      DERapp <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> tmapp <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">,</FONT> s1+s2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">,</FONT> tpfun <FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> s1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">,</FONT> s2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">DER0 <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">:</FONT>tps<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>s<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> s<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">INS <FONT COLOR="#000000">(</FONT>tps<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">,</FONT> tps<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>tps</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> INSone <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">,</FONT> tpsmore <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G1<FONT COLOR="#000000">,</FONT>G2<FONT COLOR="#000000">:</FONT>tps</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">,</FONT>T'<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">i<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      INSshi <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tpsmore <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT> T'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> i+1<FONT COLOR="#000000">,</FONT> tpsmore <FONT COLOR="#000000">(</FONT>G2<FONT COLOR="#000000">,</FONT> T'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">INS <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">,</FONT> G2<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">RED <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">s<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> REDlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmlam t<FONT COLOR="#000000">,</FONT> tmlam t'<FONT COLOR="#000000">,</FONT> s+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">RED <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">,</FONT> s<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>t1'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">s<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      REDapp1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmapp <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> tmapp <FONT COLOR="#000000">(</FONT>t1'<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> s+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">RED <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t1'<FONT COLOR="#000000">,</FONT> s<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>t2'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">s<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      REDapp2 <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmapp <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> tmapp <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> s+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">RED <FONT COLOR="#000000">(</FONT>t2<FONT COLOR="#000000">,</FONT> t2'<FONT COLOR="#000000">,</FONT> s<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>v<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> REDapp3 <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmapp <FONT COLOR="#000000">(</FONT>tmlam t<FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">subst1 <FONT COLOR="#000000">(</FONT>v<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">RED0 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>s<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> RED <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">,</FONT> s<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#787878">(* Strong Normalization *)</FONT>
<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">SN <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      SN <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT>RED0 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#000000">[</FONT>n'<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> n' <FONT COLOR="#000000">&lt;</FONT> n<FONT COLOR="#000000">]</FONT> SN <FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT> n'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">SN0 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> SN <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">// SN is closed under reduction
</FONT><FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">forwardSN <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>sn<FONT COLOR="#000000">:</FONT><FONT COLOR="#0000FF">SN<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> red<FONT COLOR="#000000">:</FONT><FONT COLOR="#0000FF">RED0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">[</FONT>n'<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> n' <FONT COLOR="#000000">&lt;</FONT> n<FONT COLOR="#000000">]</FONT> SN<FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT> n'<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">SN fsn <FONT COLOR="#000000">=</FONT> sn</FONT> <FONT COLOR="#000000">in</FONT> fsn red <FONT COLOR="#000000">end</FONT></FONT>

<FONT COLOR="#000000">extern</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">backwardSN <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">{</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> RED0 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> SN0 t'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> SN0 t</FONT></FONT>

<FONT COLOR="#787878">(* Reducibility *)</FONT>
<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> 
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> Rbas<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> tpbas<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">SN0 t</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      Rfun <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> tpfun <FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> R <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> R <FONT COLOR="#000000">(</FONT>tmapp <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#787878">// sequence of redubility predicates for a substitution
</FONT><FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">RS <FONT COLOR="#000000">(</FONT>tms<FONT COLOR="#000000">,</FONT> tps<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> RSnil <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmsnil<FONT COLOR="#000000">,</FONT> tpsnil<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>tps</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> 
      RSmore <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmsmore <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> tpsmore<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>RS<FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> G<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">RS0<FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">:</FONT>tms<FONT COLOR="#000000">,</FONT> G<FONT COLOR="#000000">:</FONT>tps<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> RS<FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> G<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">// definition of neutral terms
</FONT><FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">NEU<FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">i<FONT COLOR="#000000">:</FONT>int</FONT><FONT COLOR="#000000">}</FONT> NEUvar<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmvar i<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> NEUapp<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>tmapp<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">extern</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">lamSN <FONT COLOR="#000000">:</FONT>
  <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>t3<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT>subst1 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">,</FONT> t3<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> SN <FONT COLOR="#000000">(</FONT>t3<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&gt;</FONT> SN <FONT COLOR="#000000">(</FONT>t2<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">appSN1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">&gt;.</FONT></FONT> <FONT COLOR="#000000">(</FONT>sn<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN<FONT COLOR="#000000">(</FONT>tmapp <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN0 t1</FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">let</FONT>
     <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">SN fsn <FONT COLOR="#000000">=</FONT> sn</FONT>
     <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">fsn1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>red<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RED0 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t1'<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN0 <FONT COLOR="#000000">(</FONT>t1'<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
       appSN1 <FONT COLOR="#000000">(</FONT>fsn <FONT COLOR="#000000">(</FONT>REDapp1 <FONT COLOR="#000000">(</FONT>red<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">in</FONT>
     backwardSN <FONT COLOR="#000000">(</FONT>fsn1<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">end</FONT></FONT>

<FONT COLOR="#787878">(* CR 2 *)</FONT>
<FONT COLOR="#787878">// R is preserved by forward reduction
</FONT><FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">cr2 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP <FONT COLOR="#000000">(</FONT>T<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> rd <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RED0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  <FONT COLOR="#000000">case+</FONT> r <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> Rbas sn <FONT COLOR="#000000">=&gt;</FONT> Rbas <FONT COLOR="#000000">(</FONT>forwardSN <FONT COLOR="#000000">(</FONT>sn<FONT COLOR="#000000">,</FONT> rd<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> Rfun <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">}</FONT></FONT> fr <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">TPfun <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> tp</FONT>
    <FONT COLOR="#000000">in</FONT>
      Rfun <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">lam</FONT> <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&lt;&gt;</FONT> cr2 <FONT COLOR="#000000">(</FONT>tp2<FONT COLOR="#000000">,</FONT> fr r<FONT COLOR="#000000">,</FONT> REDapp1 rd<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [cr2]
</FONT>
<FONT COLOR="#787878">(* CR 1 *)</FONT>
<FONT COLOR="#787878">// R implies strongly normalizing
</FONT><FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">cr1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP <FONT COLOR="#000000">(</FONT>T<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> pf<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN0 t</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  <FONT COLOR="#000000">case+</FONT> pf <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> Rbas sn <FONT COLOR="#000000">=&gt;</FONT> sn
  <FONT COLOR="#000000">|</FONT> Rfun fr <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">TPfun <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> tp</FONT>
    <FONT COLOR="#000000">in</FONT>
      appSN1 <FONT COLOR="#000000">(</FONT>cr1 <FONT COLOR="#000000">(</FONT>tp2<FONT COLOR="#000000">,</FONT> fr <FONT COLOR="#000000">(</FONT>cr4 tp1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [cr1]
</FONT>
<FONT COLOR="#787878">(* CR4 *)</FONT>
<FONT COLOR="#000000">and</FONT> cr4 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">,</FONT> 2<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP <FONT COLOR="#000000">(</FONT>T<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>tmvar 0<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">fr <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>red<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RED0 <FONT COLOR="#000000">(</FONT>tmvar 0<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
    <FONT COLOR="#000000">case+</FONT> red <FONT COLOR="#000000">of</FONT> REDlam _ <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT></FONT>
<FONT COLOR="#000000">in</FONT>
  cr3 <FONT COLOR="#000000">(</FONT>NEUvar <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">,</FONT> fr<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [cr4]
</FONT>
<FONT COLOR="#787878">(* CR 3*)</FONT>
<FONT COLOR="#787878">// (NEU t and for all t' such that t --&gt; t' we have R(t',T)) implies R(t,T)
</FONT><FONT COLOR="#000000">and</FONT> cr3 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">,</FONT> 1<FONT COLOR="#000000">&gt;.</FONT></FONT> <FONT COLOR="#000000">(</FONT>
    neu<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">NEU<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP<FONT COLOR="#000000">(</FONT>T<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">,</FONT> fr <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> RED0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> R<FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT> 
  <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">fsn <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">lam</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">lam</FONT> <FONT COLOR="#000000">(</FONT>red<FONT COLOR="#000000">:</FONT><FONT COLOR="#0000FF">RED0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&lt;&gt;</FONT> cr1 <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">,</FONT> fr red<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">sn <FONT COLOR="#000000">=</FONT> backwardSN fsn</FONT>
<FONT COLOR="#000000">in</FONT>
  <FONT COLOR="#000000">case+</FONT> tp <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> TPbas<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> Rbas sn
  <FONT COLOR="#000000">|</FONT> TPfun <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">fr <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>r1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>tmapp <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
        cr3a <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">,</FONT> neu<FONT COLOR="#000000">,</FONT> r1<FONT COLOR="#000000">,</FONT> cr1 <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> r1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> fr<FONT COLOR="#000000">)</FONT></FONT>
    <FONT COLOR="#000000">in</FONT>
      Rfun fr
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [cr3]
</FONT>
<FONT COLOR="#000000">and</FONT> cr3a <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>t1<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>m<FONT COLOR="#000000">,</FONT>n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n2<FONT COLOR="#000000">,</FONT> m+2<FONT COLOR="#000000">&gt;.</FONT></FONT> <FONT COLOR="#000000">(</FONT>
    tp1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP <FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT> n1<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP <FONT COLOR="#000000">(</FONT>T2<FONT COLOR="#000000">,</FONT> n2<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">,</FONT> neu<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">NEU t</FONT><FONT COLOR="#000000">,</FONT> r1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">,</FONT> sn1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> m<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">,</FONT> f<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> RED0 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> R <FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT> tpfun <FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>tmapp <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">ff <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>tt<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>rd<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RED0 <FONT COLOR="#000000">(</FONT>tmapp <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> tt<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>tt<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
    <FONT COLOR="#000000">case+</FONT> rd <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> REDapp1 rd <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
        <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">Rfun fr <FONT COLOR="#000000">=</FONT> f rd</FONT>
      <FONT COLOR="#000000">in</FONT>
        fr <FONT COLOR="#000000">(</FONT>r1<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> REDapp2 rd <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
        <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">SN fsn1 <FONT COLOR="#000000">=</FONT> sn1</FONT>
      <FONT COLOR="#000000">in</FONT>
        cr3a <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">,</FONT> neu<FONT COLOR="#000000">,</FONT> cr2 <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> r1<FONT COLOR="#000000">,</FONT> rd<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> fsn1 rd<FONT COLOR="#000000">,</FONT> f<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> REDapp3 _ <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">begin</FONT>
        <FONT COLOR="#000000">case+</FONT> neu <FONT COLOR="#000000">of</FONT> NEUvar<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> NEUapp<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">end</FONT></FONT>
<FONT COLOR="#000000">in</FONT>
  cr3  <FONT COLOR="#000000">(</FONT>NEUapp<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">,</FONT> ff<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [cr3a]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">mainLemmaVar <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>tps<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>ts<FONT COLOR="#000000">:</FONT>tms<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>i<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>i<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>tpi<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TPI <FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> G<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> tmi<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TMI <FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> ts<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> rs<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RS0 <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> G<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">case+</FONT> <FONT COLOR="#000000">(</FONT>tpi<FONT COLOR="#000000">,</FONT> tmi<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">(</FONT>TPIone <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> TMIone <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>  <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">RSmore <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> rs</FONT> <FONT COLOR="#000000">in</FONT> r <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">(</FONT>TPIshi tpi<FONT COLOR="#000000">,</FONT> TMIshi tmi<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT>
      <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">RSmore <FONT COLOR="#000000">(</FONT>rs<FONT COLOR="#000000">,</FONT> _<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> rs</FONT> <FONT COLOR="#000000">in</FONT> mainLemmaVar <FONT COLOR="#000000">(</FONT>tpi<FONT COLOR="#000000">,</FONT> tmi<FONT COLOR="#000000">,</FONT> rs<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">end</FONT></FONT>

<FONT COLOR="#000000">extern</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">der2tp<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>tps<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> DER0 <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> TP0 T</FONT></FONT>

<FONT COLOR="#000000">extern</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">lemma10 <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> subst <FONT COLOR="#000000">(</FONT>tmsnil<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">extern</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">lemma20 <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>ts<FONT COLOR="#000000">,</FONT>ts'<FONT COLOR="#000000">:</FONT>tms<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>t1<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">,</FONT>t''<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT>
  subshi <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> ts'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> subst <FONT COLOR="#000000">(</FONT>tmsmore <FONT COLOR="#000000">(</FONT>ts'<FONT COLOR="#000000">,</FONT> tmvar 0<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> subst1 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">,</FONT> t''<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> subst <FONT COLOR="#000000">(</FONT>tmsmore <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> t''<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">extern</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">reduceFun <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT>
    TP0 T1
  <FONT COLOR="#000000">,</FONT> TP0 T2
  <FONT COLOR="#000000">,</FONT> R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT>subst1 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> f<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> R<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> R<FONT COLOR="#000000">(</FONT>t2<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> R<FONT COLOR="#000000">(</FONT>tmapp <FONT COLOR="#000000">(</FONT>tmlam f<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">mainLemma <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>tps<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>ts<FONT COLOR="#000000">:</FONT>tms<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n+1<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">&gt;.</FONT></FONT>
     <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> rs<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RS0 <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> G<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> sub<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">subst <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> DERvar tpi <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">SUBvar tmi <FONT COLOR="#000000">=</FONT> sub</FONT>
    <FONT COLOR="#000000">in</FONT>
      mainLemmaVar <FONT COLOR="#000000">(</FONT>tpi<FONT COLOR="#000000">,</FONT> tmi<FONT COLOR="#000000">,</FONT> rs<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>

  <FONT COLOR="#000000">|</FONT> DERapp <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT> der2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">SUBapp <FONT COLOR="#000000">(</FONT>sub1<FONT COLOR="#000000">,</FONT> sub2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> sub</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">r1 <FONT COLOR="#000000">=</FONT> mainLemma <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT> rs<FONT COLOR="#000000">,</FONT> sub1<FONT COLOR="#000000">)</FONT></FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">Rfun fr1 <FONT COLOR="#000000">=</FONT> r1</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">r2 <FONT COLOR="#000000">=</FONT> mainLemma <FONT COLOR="#000000">(</FONT>der2<FONT COLOR="#000000">,</FONT> rs<FONT COLOR="#000000">,</FONT> sub2<FONT COLOR="#000000">)</FONT></FONT>
    <FONT COLOR="#000000">in</FONT>
      fr1 r2
    <FONT COLOR="#000000">end</FONT>

  <FONT COLOR="#000000">|</FONT> DERlam <FONT COLOR="#000000">(</FONT>der0<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT> 
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">TPfun<FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>s1<FONT COLOR="#000000">,</FONT>s2<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> der2tp der</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">SUBlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">,</FONT>f'<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>pf<FONT COLOR="#000000">,</FONT> sublam<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> sub</FONT>
      <FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">fr <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>m<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">,</FONT> m+1<FONT COLOR="#000000">&gt;.</FONT></FONT> <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> sn2<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>m<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT>
        <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>tmapp <FONT COLOR="#000000">(</FONT>tmlam f'<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
        <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">gr <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>sub1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">subst1 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> f'<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>T1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t2<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
          <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">rs' <FONT COLOR="#000000">=</FONT> RSmore <FONT COLOR="#000000">(</FONT>rs<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">)</FONT></FONT>
          <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">sub0 <FONT COLOR="#000000">=</FONT> lemma20 <FONT COLOR="#000000">(</FONT>pf<FONT COLOR="#000000">,</FONT> sublam<FONT COLOR="#000000">,</FONT> sub1<FONT COLOR="#000000">)</FONT></FONT>
          <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">r' <FONT COLOR="#000000">=</FONT> mainLemma <FONT COLOR="#000000">(</FONT>der0<FONT COLOR="#000000">,</FONT> rs'<FONT COLOR="#000000">,</FONT> sub0<FONT COLOR="#000000">)</FONT></FONT>
        <FONT COLOR="#000000">in</FONT>
          r'
        <FONT COLOR="#000000">end</FONT></FONT>
      <FONT COLOR="#000000">in</FONT>
        reduceFun<FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">,</FONT> gr<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">end</FONT></FONT>

      <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">f <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>tmapp <FONT COLOR="#000000">(</FONT>tmlam f'<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
       fr<FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">,</FONT> cr1 <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
    <FONT COLOR="#000000">in</FONT>
      Rfun f
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [mainLemma]
</FONT>
<FONT COLOR="#787878">// all typable terms are reducible
</FONT><FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">reduce <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER0 <FONT COLOR="#000000">(</FONT>tpsnil<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  mainLemma<FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">,</FONT> RSnil<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> lemma10<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">// the final payoff
</FONT><FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">normalize <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER0 <FONT COLOR="#000000">(</FONT>tpsnil<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN0 t</FONT> <FONT COLOR="#000000">=</FONT> 
  cr1<FONT COLOR="#000000">(</FONT>der2tp der<FONT COLOR="#000000">,</FONT> reduce der<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#787878">(* end of [STLC-SN-foas.dats] *)</FONT>
</PRE></BODY>
