<BODY BGCOLOR="#E0E0E0" TEXT="#E80000"><PRE><FONT COLOR="#787878">//
</FONT><FONT COLOR="#787878">// An implementation of mini-ML that is proven to be correct
</FONT><FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#787878">// January 2005:
</FONT><FONT COLOR="#787878">// It is completed by Hongwei Xi.
</FONT>
<FONT COLOR="#787878">// January 2007:
</FONT><FONT COLOR="#787878">// It is ported to ATS/Geizella by Hongwei Xi.
</FONT>
<FONT COLOR="#787878">// March 5th, 2008:
</FONT><FONT COLOR="#787878">// It is verified by ATS/Anairiats (without any changes being made).
</FONT>
<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">tp <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> TPnat
  <FONT COLOR="#000000">|</FONT> TPfun <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> TPtup <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">tm <FONT COLOR="#000000">=</FONT> 
  <FONT COLOR="#000000">|</FONT> TMzero
  <FONT COLOR="#000000">|</FONT> TMsucc <FONT COLOR="#000000">of</FONT> tm
  <FONT COLOR="#000000">|</FONT> TMlam <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm <FONT COLOR="#000000">-&gt;</FONT> tm<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> TMapp <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> TMtup <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> TMfst <FONT COLOR="#000000">of</FONT> tm
  <FONT COLOR="#000000">|</FONT> TMsnd <FONT COLOR="#000000">of</FONT> tm
  <FONT COLOR="#000000">|</FONT> TMfix <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm <FONT COLOR="#000000">-&gt;</FONT> tm<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> TMcase <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">,</FONT> tm <FONT COLOR="#000000">-&gt;</FONT> tm<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">ctx <FONT COLOR="#000000">=</FONT> CTXnil <FONT COLOR="#000000">|</FONT> CTXcons <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>ctx<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">ISVAL <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> ISVALzero <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMzero<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> ISVALsucc <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMsucc e<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">ISVAL <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT> tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> ISVALlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e1<FONT COLOR="#000000">,</FONT>e2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      ISVALtup <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMtup <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n1+n2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ISVAL <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> ISVAL <FONT COLOR="#000000">(</FONT>e2<FONT COLOR="#000000">,</FONT> n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">ISVAL0 <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">:</FONT> tm<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> ISVAL <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">EVAL <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> EVALzero <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMzero<FONT COLOR="#000000">,</FONT> TMzero<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e<FONT COLOR="#000000">,</FONT>v<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> EVALsucc <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMsucc e<FONT COLOR="#000000">,</FONT>TMsucc v<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">EVAL <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm <FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> EVALlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> TMlam f<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e1<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">;</FONT> <FONT COLOR="#0000FF">f1<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">;</FONT> <FONT COLOR="#0000FF">e2<FONT COLOR="#000000">,</FONT>v2<FONT COLOR="#000000">,</FONT>v<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">,</FONT>n3<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> 
      EVALapp<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMapp<FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT>e2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">,</FONT> n1+n2+n3+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>EVAL<FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> TMlam f1<FONT COLOR="#000000">,</FONT> n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> EVAL<FONT COLOR="#000000">(</FONT>e2<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">,</FONT> n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> EVAL <FONT COLOR="#000000">(</FONT>f1 v2<FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">,</FONT> n3<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e1<FONT COLOR="#000000">,</FONT>v1<FONT COLOR="#000000">,</FONT>e2<FONT COLOR="#000000">,</FONT>v2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      EVALtup <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMtup <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> TMtup <FONT COLOR="#000000">(</FONT>v1<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n1+n2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>EVAL <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> v1<FONT COLOR="#000000">,</FONT> n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> EVAL <FONT COLOR="#000000">(</FONT>e2<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">,</FONT> n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e<FONT COLOR="#000000">,</FONT>v1<FONT COLOR="#000000">,</FONT>v2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      EVALfst <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMfst e<FONT COLOR="#000000">,</FONT> v1<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">EVAL <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT> TMtup <FONT COLOR="#000000">(</FONT>v1<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e<FONT COLOR="#000000">,</FONT>v1<FONT COLOR="#000000">,</FONT>v2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      EVALsnd <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMsnd e<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">EVAL <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT> TMtup <FONT COLOR="#000000">(</FONT>v1<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">;</FONT> <FONT COLOR="#0000FF">v<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      EVALfix <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMfix f<FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">EVAL <FONT COLOR="#000000">(</FONT>f <FONT COLOR="#000000">(</FONT>TMfix f<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e0<FONT COLOR="#000000">,</FONT>e1<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">;</FONT><FONT COLOR="#0000FF">f2<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">;</FONT><FONT COLOR="#0000FF">v<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      EVALcase1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMcase <FONT COLOR="#000000">(</FONT>e0<FONT COLOR="#000000">,</FONT> e1<FONT COLOR="#000000">,</FONT> f2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">,</FONT> n1+n2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>EVAL <FONT COLOR="#000000">(</FONT>e0<FONT COLOR="#000000">,</FONT> TMzero<FONT COLOR="#000000">,</FONT> n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> EVAL <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">,</FONT> n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e0<FONT COLOR="#000000">,</FONT>e1<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">;</FONT><FONT COLOR="#0000FF">f2<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">;</FONT><FONT COLOR="#0000FF">v0<FONT COLOR="#000000">,</FONT>v<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      EVALcase2 <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMcase <FONT COLOR="#000000">(</FONT>e0<FONT COLOR="#000000">,</FONT> e1<FONT COLOR="#000000">,</FONT> f2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">,</FONT> n1+n2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>EVAL <FONT COLOR="#000000">(</FONT>e0<FONT COLOR="#000000">,</FONT> TMsucc v0<FONT COLOR="#000000">,</FONT> n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> EVAL <FONT COLOR="#000000">(</FONT>f2 v0<FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">,</FONT> n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">EVAL0 <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">:</FONT> tm<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">:</FONT> tm<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> EVAL <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">lemma0 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>e1<FONT COLOR="#000000">,</FONT>e2<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>pf<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EVAL <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">ISVAL0 <FONT COLOR="#000000">(</FONT>e2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  <FONT COLOR="#000000">case+</FONT> pf <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> EVALzero <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> ISVALzero
  <FONT COLOR="#000000">|</FONT> EVALsucc pf <FONT COLOR="#000000">=&gt;</FONT> ISVALsucc <FONT COLOR="#000000">(</FONT>lemma0 pf<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> EVALlam <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> ISVALlam
  <FONT COLOR="#000000">|</FONT> EVALapp <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> _<FONT COLOR="#000000">,</FONT> pf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> lemma0 pf
  <FONT COLOR="#000000">|</FONT> EVALtup <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> ISVALtup <FONT COLOR="#000000">(</FONT>lemma0 pf1<FONT COLOR="#000000">,</FONT> lemma0 pf2<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> EVALfst <FONT COLOR="#000000">(</FONT>pf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">ISVALtup <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT> _<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> lemma0 pf</FONT> <FONT COLOR="#000000">in</FONT> pf1 <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> EVALsnd <FONT COLOR="#000000">(</FONT>pf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">ISVALtup <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> lemma0 pf</FONT> <FONT COLOR="#000000">in</FONT> pf2 <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> EVALfix <FONT COLOR="#000000">(</FONT>pf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> lemma0 pf
  <FONT COLOR="#000000">|</FONT> EVALcase1 <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> pf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> lemma0 pf
  <FONT COLOR="#000000">|</FONT> EVALcase2 <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> pf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> lemma0 pf
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [lemma0]
</FONT>
<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">lemma1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>e<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>pf<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">ISVAL <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EVAL0 <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT> e<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  <FONT COLOR="#000000">case+</FONT> pf <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> ISVALzero <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> EVALzero
  <FONT COLOR="#000000">|</FONT> ISVALsucc pf <FONT COLOR="#000000">=&gt;</FONT> EVALsucc <FONT COLOR="#000000">(</FONT>lemma1 pf<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> ISVALlam <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> EVALlam
  <FONT COLOR="#000000">|</FONT> ISVALtup <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> EVALtup <FONT COLOR="#000000">(</FONT>lemma1 pf1<FONT COLOR="#000000">,</FONT> lemma1 pf2<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [lemma1]
</FONT>
<FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">lemma2 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>e<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>pf<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">ISVAL0 <FONT COLOR="#000000">(</FONT>TMsucc e<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">ISVAL0 <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">ISVALsucc pf <FONT COLOR="#000000">=</FONT> pf</FONT> <FONT COLOR="#000000">in</FONT> pf <FONT COLOR="#000000">end</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">datatype</FONT> <FONT COLOR="#0000FF">IN <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT>tp<FONT COLOR="#000000">,</FONT>ctx<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> 
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> INone<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>CTXcons<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>e<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e<FONT COLOR="#000000">,</FONT>e'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT>
      INshi<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>CTXcons<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>e'<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">IN<FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">datatype</FONT> <FONT COLOR="#0000FF">DER <FONT COLOR="#000000">(</FONT>ctx<FONT COLOR="#000000">,</FONT>tm<FONT COLOR="#000000">,</FONT>tp<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> 
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> DERvar <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>e<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">IN <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> DERzero<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>TMzero<FONT COLOR="#000000">,</FONT>TPnat<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> DERsucc <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>TMsucc e<FONT COLOR="#000000">,</FONT>TPnat<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>e<FONT COLOR="#000000">,</FONT>TPnat<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> 
      DERlam<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>TMlam f<FONT COLOR="#000000">,</FONT>TPfun<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">{</FONT>x<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT>DER <FONT COLOR="#000000">(</FONT>CTXcons<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>x<FONT COLOR="#000000">,</FONT>t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> f x<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e1<FONT COLOR="#000000">,</FONT>e2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      DERapp<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>TMapp<FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT>e2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>e1<FONT COLOR="#000000">,</FONT>TPfun <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>e2<FONT COLOR="#000000">,</FONT>t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e1<FONT COLOR="#000000">,</FONT>e2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      DERtup<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> TMtup<FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT>e2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> TPtup <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> e1<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      DERfst<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> TMfst e<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> e<FONT COLOR="#000000">,</FONT> TPtup <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      DERsnd<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> TMsnd e<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> e<FONT COLOR="#000000">,</FONT> TPtup <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      DERfix<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> TMfix f<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">{</FONT>x<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT>DER <FONT COLOR="#000000">(</FONT>CTXcons<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>x<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> f x<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e0<FONT COLOR="#000000">,</FONT>e1<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">;</FONT> <FONT COLOR="#0000FF">f2<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      DERcase <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> TMcase <FONT COLOR="#000000">(</FONT>e0<FONT COLOR="#000000">,</FONT> e1<FONT COLOR="#000000">,</FONT> f2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> e0<FONT COLOR="#000000">,</FONT> TPnat<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> e1<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">{</FONT>x<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> DER <FONT COLOR="#000000">(</FONT>CTXcons<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>x<FONT COLOR="#000000">,</FONT>TPnat<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> f2 x<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">datatype</FONT> <FONT COLOR="#0000FF">ENV <FONT COLOR="#000000">(</FONT>ctx<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> ENVnil<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>CTXnil<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
       ENVlamcons<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>CTXcons<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>e<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ISVAL0 e <FONT COLOR="#000000">|</FONT> ENV <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> VAL <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
       ENVfixcons<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>CTXcons<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>TMfix f<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
         <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ENV <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">{</FONT>x<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT>DER <FONT COLOR="#000000">(</FONT>CTXcons<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>x<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> f x<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">and</FONT> <FONT COLOR="#0000FF">VAL <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> VALzero <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMzero<FONT COLOR="#000000">,</FONT> TPnat<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> VALsucc <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMsucc e<FONT COLOR="#000000">,</FONT> TPnat<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">VAL <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT> TPnat<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      VALclo<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> TPfun <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> 
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ENV<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">{</FONT>x<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> DER<FONT COLOR="#000000">(</FONT>CTXcons<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>x<FONT COLOR="#000000">,</FONT>t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> f x<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">e1<FONT COLOR="#000000">,</FONT>e2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      VALtup<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMtup<FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> TPtup<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>VAL <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> VAL <FONT COLOR="#000000">(</FONT>e2<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#787878">(* need to check pattern matching always succeeds *)</FONT>
<FONT COLOR="#000000">fun</FONT> eval <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>ctx<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>e1<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT>
   <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">ENV G</FONT><FONT COLOR="#000000">,</FONT> der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>e1<FONT COLOR="#000000">,</FONT>t1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">[</FONT>e2<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">]</FONT> <FONT COLOR="#000000">(</FONT>EVAL0 <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT>e2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> VAL <FONT COLOR="#000000">(</FONT>e2<FONT COLOR="#000000">,</FONT>t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> DERvar i <FONT COLOR="#000000">=&gt;</FONT> evalVar <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> DERzero <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALzero</FONT> <FONT COLOR="#000000">|</FONT> VALzero<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> DERsucc der <FONT COLOR="#000000">=&gt;</FONT>
      <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> der<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">in</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALsucc pf</FONT> <FONT COLOR="#000000">|</FONT> VALsucc v<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> DERlam <FONT COLOR="#000000">(</FONT>fder<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALlam</FONT> <FONT COLOR="#000000">|</FONT> VALclo <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> fder<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> DERapp <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT> der2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf1</FONT> <FONT COLOR="#000000">|</FONT> c1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> der1<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf2</FONT> <FONT COLOR="#000000">|</FONT> v2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> der2<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">val</FONT> VALclo <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> fder<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> c1
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT>ENVlamcons <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">lemma0 pf2</FONT> <FONT COLOR="#000000">|</FONT> env<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> fder <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">...</FONT><FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
      <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALapp <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">,</FONT> pf<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> DERtup <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT> der2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf1</FONT> <FONT COLOR="#000000">|</FONT> v1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> der1<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf2</FONT> <FONT COLOR="#000000">|</FONT> v2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> der2<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
      <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALtup <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">|</FONT> VALtup <FONT COLOR="#000000">(</FONT>v1<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> DERfst <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val+</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> VALtup <FONT COLOR="#000000">(</FONT>v1<FONT COLOR="#000000">,</FONT> _<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> der<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
      <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALfst pf</FONT> <FONT COLOR="#000000">|</FONT> v1<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> DERsnd <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val+</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> VALtup <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> der<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
      <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALsnd pf</FONT> <FONT COLOR="#000000">|</FONT> v2<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> DERfix <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>fder<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT>ENVfixcons <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> fder<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> fder <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">...</FONT><FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
      <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALfix pf</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> DERcase <FONT COLOR="#000000">(</FONT>der0<FONT COLOR="#000000">,</FONT> der1<FONT COLOR="#000000">,</FONT> fder2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf0</FONT> <FONT COLOR="#000000">|</FONT> v0<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> der0<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
      <FONT COLOR="#000000">case+</FONT> v0 <FONT COLOR="#000000">of</FONT>
      <FONT COLOR="#000000">|</FONT> VALzero <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
          <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf1</FONT> <FONT COLOR="#000000">|</FONT> v1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> der1<FONT COLOR="#000000">)</FONT>
        <FONT COLOR="#000000">in</FONT>
          <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALcase1 <FONT COLOR="#000000">(</FONT>pf0<FONT COLOR="#000000">,</FONT> pf1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">|</FONT> v1<FONT COLOR="#000000">)</FONT>
        <FONT COLOR="#000000">end</FONT>
      <FONT COLOR="#000000">|</FONT> VALsucc v0 <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
          <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf2</FONT> <FONT COLOR="#000000">|</FONT> v2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT>
            eval <FONT COLOR="#000000">(</FONT>ENVlamcons <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">lemma2 <FONT COLOR="#000000">(</FONT>lemma0 pf0<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">|</FONT> env<FONT COLOR="#000000">,</FONT> v0<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> fder2 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">...</FONT><FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">)</FONT>
        <FONT COLOR="#000000">in</FONT>
          <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALcase2 <FONT COLOR="#000000">(</FONT>pf0<FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">|</FONT> v2<FONT COLOR="#000000">)</FONT>
        <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [eval]
</FONT>
<FONT COLOR="#000000">and</FONT> evalVar <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>ctx<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>e1<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">ENV G</FONT><FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">IN<FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">[</FONT>e2<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">]</FONT> <FONT COLOR="#000000">(</FONT>EVAL0 <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> VAL <FONT COLOR="#000000">(</FONT>e2<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  <FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> INone <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> env <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> ENVlamcons <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> _<FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">lemma1 pf</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">|</FONT> ENVfixcons <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> fder<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
          <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT>ENVfixcons <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> fder<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> fder<FONT COLOR="#000000">)</FONT>
        <FONT COLOR="#000000">in</FONT>
          <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALfix pf</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT>
         <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> INshi i <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> env <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> ENVlamcons <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">_</FONT> <FONT COLOR="#000000">|</FONT> env<FONT COLOR="#000000">,</FONT> _<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> evalVar <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">|</FONT> ENVfixcons <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> _<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> evalVar <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end [of evalVar]
</FONT>
<FONT COLOR="#000000">typedef</FONT> <FONT COLOR="#0000FF">DER0 <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> DER <FONT COLOR="#000000">(</FONT>CTXnil<FONT COLOR="#000000">,</FONT> e<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">fun</FONT> evaluate <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>e<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER0 <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">[</FONT>e'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">]</FONT> <FONT COLOR="#000000">(</FONT>EVAL0 <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">,</FONT>e'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> VAL<FONT COLOR="#000000">(</FONT>e'<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  eval <FONT COLOR="#000000">(</FONT>ENVnil<FONT COLOR="#000000">,</FONT> der<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [evaluate]
</FONT>
<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#787878">(* end of [miniML.dats] *)</FONT>
</PRE></BODY>
