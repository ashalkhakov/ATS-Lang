<BODY BGCOLOR="#E0E0E0" TEXT="#E80000"><PRE><FONT COLOR="#787878">//
</FONT><FONT COLOR="#787878">//
</FONT><FONT COLOR="#787878">// A typeful implementation of CPS transformation
</FONT><FONT COLOR="#787878">//
</FONT><FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#787878">// December 2004
</FONT><FONT COLOR="#787878">// The code is written by Hongwei Xi
</FONT>
<FONT COLOR="#787878">// January 2007
</FONT><FONT COLOR="#787878">// The code is ported to ATS/Geizella by Hongwei Xi
</FONT>
<FONT COLOR="#787878">// March 3rd, 2007
</FONT><FONT COLOR="#787878">// The code is ported to ATS/Anairiats by Hongwei Xi
</FONT>
<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#800080"><FONT COLOR="#000000">infixr</FONT> -&gt;&gt; ::</FONT>

<FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">ty <FONT COLOR="#000000">=</FONT> int <FONT COLOR="#000000">|</FONT> -&gt;&gt; <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>ty<FONT COLOR="#000000">,</FONT> ty<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> bot <FONT COLOR="#000000">|</FONT> cont <FONT COLOR="#000000">of</FONT> ty</FONT>
<FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">env <FONT COLOR="#000000">=</FONT> nil <FONT COLOR="#000000">|</FONT> :: <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>ty<FONT COLOR="#000000">,</FONT> env<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">datatype</FONT> <FONT COLOR="#0000FF">VAR <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> ty<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>env</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> VARone <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t :: G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>env</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> VARshi <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t2 :: G<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">VAR <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">fun</FONT> nat_of_var <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>x<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">VAR <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">Nat</FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">case+</FONT> x <FONT COLOR="#000000">of</FONT> VARone <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> 1 <FONT COLOR="#000000">|</FONT> VARshi x <FONT COLOR="#000000">=&gt;</FONT> 1 + nat_of_var x

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">datatype</FONT> <FONT COLOR="#0000FF">EXP <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> ty<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>env</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> EXPvar <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">VAR <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>env</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> EXPlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1 -&gt;&gt; t2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">EXP <FONT COLOR="#000000">(</FONT>t1 :: G<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>env</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> EXPapp <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>EXP <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1 -&gt;&gt; t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> EXP <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>env</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> EXPlet <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>EXP <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> EXP <FONT COLOR="#000000">(</FONT>t1 :: G<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>env</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> EXPcal <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">EXP <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> cont<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">)</FONT> -&gt;&gt; t<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>env</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> EXPthr <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>EXP <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> cont t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> EXP <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">typedef</FONT> <FONT COLOR="#0000FF">EXP0 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">:</FONT> ty<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> EXP <FONT COLOR="#000000">(</FONT>nil<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">RT1 <FONT COLOR="#000000">(</FONT>ty<FONT COLOR="#000000">,</FONT> ty<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> RT1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">(</FONT>t' -&gt;&gt; bot<FONT COLOR="#000000">)</FONT> -&gt;&gt; bot<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">RT2 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">and</FONT> <FONT COLOR="#0000FF">RT2 <FONT COLOR="#000000">(</FONT>ty<FONT COLOR="#000000">,</FONT> ty<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> RT2int <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>int<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>t1'<FONT COLOR="#000000">,</FONT>t2'<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      RT2fun <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t1 -&gt;&gt; t2<FONT COLOR="#000000">,</FONT> t1' -&gt;&gt; t2'<FONT COLOR="#000000">,</FONT>n1+n2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>RT2<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t1'<FONT COLOR="#000000">,</FONT>n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> RT1 <FONT COLOR="#000000">(</FONT>t2<FONT COLOR="#000000">,</FONT> t2'<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> RT2bot <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>bot<FONT COLOR="#000000">,</FONT> bot<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> RT2cont<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>cont<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> t' -&gt;&gt; bot<FONT COLOR="#000000">,</FONT>n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">RT2 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">RT10 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">:</FONT> ty<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">:</FONT> ty<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> RT1 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>
<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">RT20 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">:</FONT> ty<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">:</FONT> ty<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> RT2 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">extern</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">rt1fun<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;&gt;</FONT> <FONT COLOR="#000000">[</FONT>t'<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">]</FONT> RT10 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT></FONT></FONT>
<FONT COLOR="#000000">extern</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">rt2fun<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;&gt;</FONT> <FONT COLOR="#000000">[</FONT>t2<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">]</FONT> RT20 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#787878">(*

prfun rt1fun {t:ty} .&lt;t&gt;. = RT1 (rt2fun {t})

and rt2fun {t:ty} .&lt;t&gt;. =
  scase t of
    | int =&gt; RT2int (int, int, 0)
    | t1 -&gt;&gt; t2 =&gt; RT2fun (rt2fun {t1}, rt1fun {t2})
    | bot -&gt; RT2bot (bot, bot, 0)
    | cont t =&gt; RT2cont (rt2fun {t})

*)</FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">TYEQ <FONT COLOR="#000000">(</FONT>ty<FONT COLOR="#000000">,</FONT> ty<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> TYEQ <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">rt1eq <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n1<FONT COLOR="#000000">&gt;.</FONT></FONT>
   <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RT1 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">,</FONT> n1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RT1 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">,</FONT> n2<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:&lt;&gt;</FONT> <FONT COLOR="#0000FF">TYEQ <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT>  <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">(</FONT>RT1 pf1<FONT COLOR="#000000">,</FONT> RT1 pf2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">TYEQ <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> rt2eq <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">in</FONT> TYEQ <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [rt1eq]
</FONT>
<FONT COLOR="#000000">and</FONT> rt2eq <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n1<FONT COLOR="#000000">&gt;.</FONT></FONT>
   <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RT2 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">,</FONT> n1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RT2 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">,</FONT> n2<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:&lt;&gt;</FONT> <FONT COLOR="#0000FF">TYEQ <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  <FONT COLOR="#000000">case+</FONT> <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">of</FONT> 
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">(</FONT>RT2int <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> RT2int <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> TYEQ
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">(</FONT>RT2fun <FONT COLOR="#000000">(</FONT>pf11<FONT COLOR="#000000">,</FONT> pf12<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> RT2fun <FONT COLOR="#000000">(</FONT>pf21<FONT COLOR="#000000">,</FONT> pf22<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">TYEQ <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> rt2eq <FONT COLOR="#000000">(</FONT>pf11<FONT COLOR="#000000">,</FONT> pf21<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">and</FONT> TYEQ <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> rt1eq <FONT COLOR="#000000">(</FONT>pf12<FONT COLOR="#000000">,</FONT> pf22<FONT COLOR="#000000">)</FONT></FONT>
    <FONT COLOR="#000000">in</FONT>
      TYEQ <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">(</FONT>RT2cont pf1<FONT COLOR="#000000">,</FONT> RT2cont pf2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT>
      <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">TYEQ <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> rt2eq <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">in</FONT> TYEQ <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">(</FONT>RT2bot <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> RT2bot <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> TYEQ <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [rt2eq]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">datatype</FONT> <FONT COLOR="#0000FF">EXP' <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> ty<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>env</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> EXPvar' <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">VAR <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>env</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> EXPlam' <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1 -&gt;&gt; t2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">EXP' <FONT COLOR="#000000">(</FONT>t1 :: G<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>env</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> EXPapp' <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>EXP' <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1 -&gt;&gt; t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> EXP' <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>env</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty</FONT><FONT COLOR="#000000">}</FONT> EXPlet' <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>EXP' <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> EXP' <FONT COLOR="#000000">(</FONT>t1 :: G<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">typedef</FONT> <FONT COLOR="#0000FF">EXP0' <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> EXP' <FONT COLOR="#000000">(</FONT>nil<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">typedef</FONT> <FONT COLOR="#0000FF">SUB <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">,</FONT> G2<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT> VAR<FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&gt;</FONT> EXP' <FONT COLOR="#000000">(</FONT>G2<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">extern</FONT> <FONT COLOR="#000000">fun</FONT> print_exp1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>e0<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP' <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT>
<FONT COLOR="#000000">overload</FONT> <FONT COLOR="#800080">print <FONT COLOR="#000000">with</FONT> print_exp1</FONT>

<FONT COLOR="#000000">implement</FONT> print_exp1 e0 <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> e0 <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> EXPvar' x <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val</FONT> n <FONT COLOR="#000000">=</FONT> nat_of_var x
    <FONT COLOR="#000000">in</FONT>
      print "EXPvar' ("<FONT COLOR="#000000">;</FONT> print n<FONT COLOR="#000000">;</FONT> print ")"
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> EXPlam' e <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT>
      print "EXPlam' ("<FONT COLOR="#000000">;</FONT> print_exp1 e<FONT COLOR="#000000">;</FONT> print ")"
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> EXPapp' <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT>
      print "EXPapp' ("<FONT COLOR="#000000">;</FONT> print_exp1 e1<FONT COLOR="#000000">;</FONT> print ", "<FONT COLOR="#000000">;</FONT> print_exp1 e2<FONT COLOR="#000000">;</FONT> print ")"
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> EXPlet' <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT>
      print "EXPlet' ("<FONT COLOR="#000000">;</FONT> print_exp1 e1<FONT COLOR="#000000">;</FONT> print ", "<FONT COLOR="#000000">;</FONT> print_exp1 e2<FONT COLOR="#000000">;</FONT> print ")"
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [print_exp1]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">val</FONT> idSub <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">lam</FONT> x <FONT COLOR="#000000">=&gt;</FONT> EXPvar' x<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">}</FONT> SUB <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> G<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">val</FONT> shiSub <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">lam</FONT> x <FONT COLOR="#000000">=&gt;</FONT> EXPvar' <FONT COLOR="#000000">(</FONT>VARshi x<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT> SUB <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t :: G<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">fun</FONT> subst <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G1<FONT COLOR="#000000">,</FONT>G2<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT>
   <FONT COLOR="#000000">(</FONT>sub<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SUB<FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT>G2<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP' <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP' <FONT COLOR="#000000">(</FONT>G2<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> e <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> EXPvar' x <FONT COLOR="#000000">=&gt;</FONT> sub <FONT COLOR="#000000">(</FONT>x<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> EXPlam' e <FONT COLOR="#000000">=&gt;</FONT> EXPlam' <FONT COLOR="#000000">(</FONT>subst <FONT COLOR="#000000">(</FONT>subLam sub<FONT COLOR="#000000">)</FONT> e<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> EXPapp' <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> EXPapp' <FONT COLOR="#000000">(</FONT>subst sub e1<FONT COLOR="#000000">,</FONT> subst sub e2<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> EXPlet' <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> EXPlet' <FONT COLOR="#000000">(</FONT>subst sub e1<FONT COLOR="#000000">,</FONT> subst <FONT COLOR="#000000">(</FONT>subLam sub<FONT COLOR="#000000">)</FONT> e2<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [subst]
</FONT>
<FONT COLOR="#000000">and</FONT> subLam <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G1<FONT COLOR="#000000">,</FONT>G2<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>sub<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SUB <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT>G2<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SUB <FONT COLOR="#000000">(</FONT>t::G1<FONT COLOR="#000000">,</FONT>t::G2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  <FONT COLOR="#000000">lam</FONT> x <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">case+</FONT> x <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> VARone <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> EXPvar' <FONT COLOR="#000000">(</FONT>VARone<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">|</FONT> VARshi x' <FONT COLOR="#000000">=&gt;</FONT> subst <FONT COLOR="#000000">(</FONT>shiSub <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">(</FONT>sub x'<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [subLam]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">fn</FONT> EXPone1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP' <FONT COLOR="#000000">(</FONT>t :: G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> EXPvar' <FONT COLOR="#000000">(</FONT>VARone<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">fn</FONT> EXPtwo1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP' <FONT COLOR="#000000">(</FONT>t1 :: t2 :: G<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  EXPvar' <FONT COLOR="#000000">(</FONT>VARshi VARone<FONT COLOR="#000000">)</FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">fn</FONT> expShi <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>e<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP' <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP' <FONT COLOR="#000000">(</FONT>t2 :: G<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  subst <FONT COLOR="#000000">(</FONT>shiSub <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">)</FONT> e

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">typedef</FONT> <FONT COLOR="#0000FF">VM <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">:</FONT> env<FONT COLOR="#000000">,</FONT> G2<FONT COLOR="#000000">:</FONT> env<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT> VAR <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&gt;</FONT> <FONT COLOR="#000000">[</FONT>t2<FONT COLOR="#000000">:</FONT> ty<FONT COLOR="#000000">]</FONT> <FONT COLOR="#000000">(</FONT>RT20 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> VAR <FONT COLOR="#000000">(</FONT>G2<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">val</FONT> vmNil <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">lam</FONT> x <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">case+</FONT> x <FONT COLOR="#000000">of</FONT> VARone _ <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> VARshi _ <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">VM <FONT COLOR="#000000">(</FONT>nil<FONT COLOR="#000000">,</FONT> nil<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">fn</FONT> vmShi <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G1<FONT COLOR="#000000">,</FONT>G2<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>vm<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">VM <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT> G2<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">lam</FONT> x1 <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> x2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> vm x1 <FONT COLOR="#000000">in</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> VARshi x2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">end</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">VM <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT> t :: G2<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">fn</FONT> vmLam <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G1<FONT COLOR="#000000">,</FONT>G2<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT>
   <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RT20 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT></FONT> <FONT COLOR="#000000">|</FONT> vm<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">VM <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT> G2<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">VM <FONT COLOR="#000000">(</FONT>t1 :: G1<FONT COLOR="#000000">,</FONT> t2 :: G2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">lam</FONT> x1 <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">case+</FONT> x1 <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> VARone <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> VARone<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">|</FONT> VARshi x1 <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> x2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> vm x1 <FONT COLOR="#000000">in</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> VARshi x2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">end</FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">fun</FONT> cps <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G1<FONT COLOR="#000000">,</FONT>G2<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT>
   <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RT10 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT></FONT> <FONT COLOR="#000000">|</FONT> vm<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">VM <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT> G2<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> e<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP' <FONT COLOR="#000000">(</FONT>G2<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">RT1 <FONT COLOR="#000000">(</FONT>pf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> pf</FONT> <FONT COLOR="#000000">in</FONT> EXPlam' <FONT COLOR="#000000">(</FONT>cpsw <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> vmShi vm<FONT COLOR="#000000">,</FONT> EXPone1 <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> e<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">end</FONT>

<FONT COLOR="#000000">and</FONT> cpsw <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G1<FONT COLOR="#000000">,</FONT>G2<FONT COLOR="#000000">:</FONT>env<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT>
   <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RT20 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT></FONT> <FONT COLOR="#000000">|</FONT> vm<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">VM <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT> G2<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> k<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP' <FONT COLOR="#000000">(</FONT>G2<FONT COLOR="#000000">,</FONT> t2 -&gt;&gt; bot<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> e<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP <FONT COLOR="#000000">(</FONT>G1<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP' <FONT COLOR="#000000">(</FONT>G2<FONT COLOR="#000000">,</FONT> bot<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> e <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> EXPvar x1 <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf'</FONT> <FONT COLOR="#000000">|</FONT> x2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> vm x1
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">TYEQ <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> rt2eq <FONT COLOR="#000000">(</FONT>pf<FONT COLOR="#000000">,</FONT> pf'<FONT COLOR="#000000">)</FONT></FONT>
    <FONT COLOR="#000000">in</FONT>
      EXPapp' <FONT COLOR="#000000">(</FONT>k<FONT COLOR="#000000">,</FONT> EXPvar' x2<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>

  <FONT COLOR="#000000">|</FONT> EXPlam e <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">RT2fun <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> pf</FONT>
    <FONT COLOR="#000000">in</FONT>
      EXPapp' <FONT COLOR="#000000">(</FONT>k<FONT COLOR="#000000">,</FONT> EXPlam' <FONT COLOR="#000000">(</FONT>cps <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf2</FONT> <FONT COLOR="#000000">|</FONT> vmLam <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf1</FONT> <FONT COLOR="#000000">|</FONT> vm<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> e<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>

  <FONT COLOR="#000000">|</FONT> EXPapp <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT> _<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">pf1 <FONT COLOR="#000000">=</FONT> rt2fun <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT></FONT>
      <FONT COLOR="#000000">val</FONT> k <FONT COLOR="#000000">=</FONT> EXPlam' <FONT COLOR="#000000">(</FONT>EXPapp' <FONT COLOR="#000000">(</FONT>EXPapp' <FONT COLOR="#000000">(</FONT>EXPtwo1 <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> EXPone1 <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> expShi <FONT COLOR="#000000">(</FONT>expShi k<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">val</FONT> k <FONT COLOR="#000000">=</FONT> EXPlam' <FONT COLOR="#000000">(</FONT>cpsw <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf1</FONT> <FONT COLOR="#000000">|</FONT> vmShi vm<FONT COLOR="#000000">,</FONT> k<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
      cpsw <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">RT2fun <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT> RT1 pf<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">|</FONT> vm<FONT COLOR="#000000">,</FONT> k<FONT COLOR="#000000">,</FONT> e1<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>

  <FONT COLOR="#000000">|</FONT> EXPlet <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT> _<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">pf1 <FONT COLOR="#000000">=</FONT> rt2fun <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT></FONT>
      <FONT COLOR="#000000">val</FONT> k <FONT COLOR="#000000">=</FONT> EXPlam' <FONT COLOR="#000000">(</FONT>
        EXPlet' <FONT COLOR="#000000">(</FONT>EXPone1 <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> expShi <FONT COLOR="#000000">(</FONT>cpsw <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> vmLam <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf1</FONT> <FONT COLOR="#000000">|</FONT> vm<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> expShi k<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
       cpsw <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf1</FONT> <FONT COLOR="#000000">|</FONT> vm<FONT COLOR="#000000">,</FONT> k<FONT COLOR="#000000">,</FONT> e1<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>

  <FONT COLOR="#000000">|</FONT> EXPcal e <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val</FONT> k <FONT COLOR="#000000">=</FONT> expShi k
      <FONT COLOR="#000000">val</FONT> k <FONT COLOR="#000000">=</FONT> EXPlam' <FONT COLOR="#000000">(</FONT>EXPapp' <FONT COLOR="#000000">(</FONT>EXPapp' <FONT COLOR="#000000">(</FONT>EXPone1 <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> k<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> k<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
      cpsw <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">RT2fun <FONT COLOR="#000000">(</FONT>RT2cont pf<FONT COLOR="#000000">,</FONT> RT1 pf<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">|</FONT> vm<FONT COLOR="#000000">,</FONT> k<FONT COLOR="#000000">,</FONT> e<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>

  <FONT COLOR="#000000">|</FONT> EXPthr <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>_<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">pf1 <FONT COLOR="#000000">=</FONT> rt2fun <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT></FONT>
      <FONT COLOR="#000000">val</FONT> k <FONT COLOR="#000000">=</FONT> EXPlam' <FONT COLOR="#000000">(</FONT>cpsw <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf1</FONT> <FONT COLOR="#000000">|</FONT> vmShi vm<FONT COLOR="#000000">,</FONT> EXPone1 <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
      cpsw <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">RT2cont pf1</FONT> <FONT COLOR="#000000">|</FONT> vm<FONT COLOR="#000000">,</FONT> k<FONT COLOR="#000000">,</FONT> e1<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [cpsw]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">fn</FONT> cps0 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RT10 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT></FONT></FONT> <FONT COLOR="#000000">|</FONT> e<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP0 t1</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EXP0' t2</FONT> <FONT COLOR="#000000">=</FONT>
  cps <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> vmNil<FONT COLOR="#000000">,</FONT> e<FONT COLOR="#000000">)</FONT>

<FONT COLOR="#787878">// Some examples
</FONT>
<FONT COLOR="#000000">val</FONT> ans1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">[</FONT>t<FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">]</FONT> EXP0' t</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000"><FONT COLOR="#000000">[</FONT><FONT COLOR="#0000FF">t2</FONT><FONT COLOR="#000000">:</FONT>ty<FONT COLOR="#000000">]</FONT> pf <FONT COLOR="#000000">=</FONT> rt1fun <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>int -&gt;&gt; int<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT></FONT>
<FONT COLOR="#000000">in</FONT>
  cps0 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>int-&gt;&gt;int<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> EXPlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>nil<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>int<FONT COLOR="#000000">,</FONT>int<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>EXPvar VARone<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT>

<FONT COLOR="#000000">implement</FONT> main <FONT COLOR="#000000">(</FONT>argc<FONT COLOR="#000000">,</FONT> argv<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>

<FONT COLOR="#000000">in</FONT>

print "ans1 = "<FONT COLOR="#000000">;</FONT> print ans1<FONT COLOR="#000000">;</FONT> print_newline <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>

<FONT COLOR="#000000">end</FONT>

<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#787878">(* end of [CPS.dats] *)</FONT>
</PRE></BODY>
