<BODY BGCOLOR="#E0E0E0" TEXT="#E80000"><PRE><FONT COLOR="#787878">//
</FONT><FONT COLOR="#787878">//
</FONT><FONT COLOR="#787878">// simply typed lambda calculus is strongly-normalizing
</FONT><FONT COLOR="#787878">// This formalization uses higher-order abstract syntax for lambda-terms.
</FONT><FONT COLOR="#787878">//
</FONT><FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#787878">// April 2006:
</FONT><FONT COLOR="#787878">// It is completed by Kevin Donnelly and Hongwei Xi
</FONT>
<FONT COLOR="#787878">// January 2007:
</FONT><FONT COLOR="#787878">// It is ported to ATS/Geizella by Hongwei Xi
</FONT>
<FONT COLOR="#787878">// March 3rd, 2008
</FONT><FONT COLOR="#787878">// It is ported to ATS/Anairiats by Hongwei Xi
</FONT>
<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#787878">// This is a proof based on Tait's method of reducibility predicates
</FONT>
<FONT COLOR="#787878">(* Syntax *)</FONT>
<FONT COLOR="#787878">// definition of sort 'tm' of HOAS terms
</FONT><FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">tm <FONT COLOR="#000000">=</FONT> TMcst
            <FONT COLOR="#000000">|</FONT> TMlam <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm <FONT COLOR="#000000">-&gt;</FONT> tm<FONT COLOR="#000000">)</FONT>
            <FONT COLOR="#000000">|</FONT> TMapp <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">// definition of sort 'tp' for simple types with a base type
</FONT><FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">tp <FONT COLOR="#000000">=</FONT> TPbas <FONT COLOR="#000000">|</FONT> TPfun <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">,</FONT>tp<FONT COLOR="#000000">)</FONT></FONT> 

<FONT COLOR="#787878">// sort for typing contexts (really, typed substitutions)
</FONT><FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">ctx <FONT COLOR="#000000">=</FONT> CTXnil <FONT COLOR="#000000">|</FONT> CTXcons <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">,</FONT> ctx<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">(* Reduction *)</FONT>
<FONT COLOR="#787878">// small-step reduction
</FONT><FONT COLOR="#787878">// RED(t, t', n) represents n length derivations of t --&gt; t'
</FONT><FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">RED <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">,</FONT>f'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">s<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      REDlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> TMlam f'<FONT COLOR="#000000">,</FONT> s+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>x<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> RED <FONT COLOR="#000000">(</FONT>f x<FONT COLOR="#000000">,</FONT> f' x<FONT COLOR="#000000">,</FONT> s<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>t1'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">s<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      REDapp1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMapp <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> TMapp <FONT COLOR="#000000">(</FONT>t1'<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> s+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">RED <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t1'<FONT COLOR="#000000">,</FONT> s<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>t2'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">s<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      REDapp2 <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMapp <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> TMapp <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> s+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">RED <FONT COLOR="#000000">(</FONT>t2<FONT COLOR="#000000">,</FONT> t2'<FONT COLOR="#000000">,</FONT> s<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">;</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> REDapp3 <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMapp <FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> f t<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">RED0 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>s<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> RED <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">,</FONT> s<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">(* Type Assignment *)</FONT>
<FONT COLOR="#787878">// dynamic type representation (and index for structural induction on types)
</FONT><FONT COLOR="#787878">// TP (t) represents derivations of the judgment 't type'
</FONT><FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">TP <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> TPbas <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TPbas<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> TPfun <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TPfun <FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TP T1<FONT COLOR="#000000">,</FONT> TP T2<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#787878">// Context lookup, INCTX(t, T, G) represents (t: T) \in G
</FONT><FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">INCTX <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT>tp<FONT COLOR="#000000">,</FONT>ctx<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> 
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> INCTXone<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">,</FONT>T'<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      INCTXshi<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT>T'<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">INCTX<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#787878">// typing derivations in first-order representation
</FONT><FONT COLOR="#787878">// DER(G, t, T, n) represents n length derivations of G |- t: T
</FONT><FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">DER <FONT COLOR="#000000">(</FONT>ctx<FONT COLOR="#000000">,</FONT>tm<FONT COLOR="#000000">,</FONT>tp<FONT COLOR="#000000">,</FONT>int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      DERvar<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>0<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>INCTX <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> TP T<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      DERlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>TMlam f<FONT COLOR="#000000">,</FONT> TPfun<FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TP T1<FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">{</FONT>x<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> DER <FONT COLOR="#000000">(</FONT>CTXcons <FONT COLOR="#000000">(</FONT>x<FONT COLOR="#000000">,</FONT>T1<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> f x<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> 
      DERapp <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> TMapp<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">,</FONT> n1+n2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">,</FONT> TPfun<FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">,</FONT> n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">DER0 <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">:</FONT>ctx<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">(* Strong Normalization *)</FONT>
<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">SN <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> SN <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> 
      <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT>RED0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#000000">[</FONT>n'<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> n' <FONT COLOR="#000000">&lt;</FONT> n<FONT COLOR="#000000">]</FONT> SN<FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT>n'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">SN0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> SN<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#787878">// If everything t reduces to is SN then t is SN.  We leave this as an
</FONT><FONT COLOR="#787878">// unproven lemma because it is obvious, but has a complicated formal proof.
</FONT><FONT COLOR="#000000">extern</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">backwardSN <FONT COLOR="#000000">:</FONT>
  <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">{</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> RED0 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> SN0 t'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> SN0 t</FONT></FONT>

<FONT COLOR="#787878">// SN is closed under reduction
</FONT><FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">forwardSN <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>sn <FONT COLOR="#000000">:</FONT><FONT COLOR="#0000FF">SN<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> red <FONT COLOR="#000000">:</FONT><FONT COLOR="#0000FF">RED0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">[</FONT>n'<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> n' <FONT COLOR="#000000">&lt;</FONT> n<FONT COLOR="#000000">]</FONT> SN<FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT> n'<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">SN fsn <FONT COLOR="#000000">=</FONT> sn</FONT> <FONT COLOR="#000000">in</FONT> fsn red <FONT COLOR="#000000">end</FONT></FONT>

<FONT COLOR="#787878">(* Reducibility *)</FONT>
<FONT COLOR="#787878">// reducibility
</FONT><FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> 
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> Rbas<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> TPbas<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">SN0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      Rfun <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> TPfun<FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> R<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> R<FONT COLOR="#000000">(</FONT>TMapp<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#787878">// sequence of redubility predicates for a substitution
</FONT><FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">RS <FONT COLOR="#000000">(</FONT>ctx<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> RSnil <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>CTXnil<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      RScons<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> RS G<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#787878">// definition of neutral terms
</FONT><FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">NEU <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> NEUcst<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMcst<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> NEUapp<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMapp<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">lamSN <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm<FONT COLOR="#000000">;</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>sn<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN <FONT COLOR="#000000">(</FONT>f t<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN <FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">SN fsn <FONT COLOR="#000000">=</FONT> sn</FONT>
  <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">fsn' <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT>
    <FONT COLOR="#000000">(</FONT>rd<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RED0 <FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:&lt;&gt;</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">[</FONT>n'<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> n' <FONT COLOR="#000000">&lt;</FONT> n<FONT COLOR="#000000">]</FONT> SN <FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT> n'<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
    <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">REDlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">,</FONT>f'<FONT COLOR="#000000">}</FONT></FONT> frd <FONT COLOR="#000000">=</FONT> rd</FONT>
  <FONT COLOR="#000000">in</FONT>
    lamSN <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f'<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>fsn <FONT COLOR="#000000">(</FONT>frd <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [fsn']
</FONT><FONT COLOR="#000000">in</FONT>
  SN <FONT COLOR="#000000">(</FONT>fsn'<FONT COLOR="#000000">)</FONT>     
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [lamSN]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">appSN1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>sn<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN<FONT COLOR="#000000">(</FONT>TMapp <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN0 t1</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">SN fsn <FONT COLOR="#000000">=</FONT> sn</FONT>
  <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">fsn1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>red<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RED0 <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> t1'<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN0 <FONT COLOR="#000000">(</FONT>t1'<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
    appSN1 <FONT COLOR="#000000">(</FONT>fsn <FONT COLOR="#000000">(</FONT>REDapp1 <FONT COLOR="#000000">(</FONT>red<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
<FONT COLOR="#000000">in</FONT>
  backwardSN <FONT COLOR="#000000">(</FONT>fsn1<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [appSN1]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#787878">(* CR 2 *)</FONT>
<FONT COLOR="#787878">// R is preserved by forward reduction
</FONT><FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">cr2 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>T<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> rd<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RED0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  <FONT COLOR="#000000">case+</FONT> r <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> Rbas sn <FONT COLOR="#000000">=&gt;</FONT> Rbas <FONT COLOR="#000000">(</FONT>forwardSN <FONT COLOR="#000000">(</FONT>sn<FONT COLOR="#000000">,</FONT> rd<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> Rfun <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>fr<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT>
      Rfun <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">lam</FONT> <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&lt;&gt;</FONT> cr2 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T2<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>fr r<FONT COLOR="#000000">,</FONT> REDapp1 rd<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [cr2]
</FONT>
<FONT COLOR="#787878">(* CR 1 *)</FONT>
<FONT COLOR="#787878">// R implies strongly normalizing
</FONT><FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">cr1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>T<FONT COLOR="#000000">,</FONT>0<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP T</FONT><FONT COLOR="#000000">,</FONT> pf<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  <FONT COLOR="#000000">case+</FONT> pf <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> Rbas sn <FONT COLOR="#000000">=&gt;</FONT> sn
  <FONT COLOR="#000000">|</FONT> Rfun fr <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">TPfun <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> tp</FONT>
    <FONT COLOR="#000000">in</FONT>
      appSN1 <FONT COLOR="#000000">(</FONT>cr1 <FONT COLOR="#000000">(</FONT>tp2<FONT COLOR="#000000">,</FONT> fr <FONT COLOR="#000000">(</FONT>cr4 tp1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [cr1]
</FONT>
<FONT COLOR="#787878">(* CR4 *)</FONT>
<FONT COLOR="#000000">and</FONT> cr4 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>T<FONT COLOR="#000000">,</FONT>2<FONT COLOR="#000000">&gt;.</FONT></FONT> <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP T</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>TMcst<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">fr <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>red<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RED0 <FONT COLOR="#000000">(</FONT>TMcst<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
    <FONT COLOR="#000000">case+</FONT> red <FONT COLOR="#000000">of</FONT> REDlam _ <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT></FONT>
<FONT COLOR="#000000">in</FONT>
  cr3 <FONT COLOR="#000000">(</FONT>NEUcst <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">,</FONT> fr<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [cr4]
</FONT>
<FONT COLOR="#787878">(* CR 3*)</FONT>
<FONT COLOR="#787878">// (NEU t and for all t' such that t --&gt; t' we have R(t',T)) implies R(t,T)
</FONT><FONT COLOR="#000000">and</FONT> cr3 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>T<FONT COLOR="#000000">,</FONT>1<FONT COLOR="#000000">&gt;.</FONT></FONT> <FONT COLOR="#000000">(</FONT>
    neu<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">NEU<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP T</FONT>
  <FONT COLOR="#000000">,</FONT> fr<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> RED0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> R<FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">fsn <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">lam</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">lam</FONT> <FONT COLOR="#000000">(</FONT>red<FONT COLOR="#000000">:</FONT><FONT COLOR="#0000FF">RED0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&lt;&gt;</FONT> cr1 <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">,</FONT> fr red<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">sn <FONT COLOR="#000000">=</FONT> backwardSN fsn</FONT>
<FONT COLOR="#000000">in</FONT>
  <FONT COLOR="#000000">case+</FONT> tp <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> TPbas<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> Rbas sn
  <FONT COLOR="#000000">|</FONT> TPfun <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">fr <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t1<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>r1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>TMapp <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
        cr3a <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">,</FONT> neu<FONT COLOR="#000000">,</FONT> r1<FONT COLOR="#000000">,</FONT> cr1 <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> r1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> fr<FONT COLOR="#000000">)</FONT></FONT>
    <FONT COLOR="#000000">in</FONT>
      Rfun fr
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [cr3]
</FONT>
<FONT COLOR="#000000">and</FONT> cr3a <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>t1<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>m<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>T2<FONT COLOR="#000000">,</FONT> m+2<FONT COLOR="#000000">&gt;.</FONT></FONT> <FONT COLOR="#000000">(</FONT>
    tp1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP T1</FONT>
  <FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP T2</FONT>
  <FONT COLOR="#000000">,</FONT> neu<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">NEU t</FONT>
  <FONT COLOR="#000000">,</FONT> r1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">,</FONT> sn1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN <FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT> m<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">,</FONT> f<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> RED0 <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> R <FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT> TPfun <FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>TMapp <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">ff <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>tt<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>rd<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RED0 <FONT COLOR="#000000">(</FONT>TMapp <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> tt<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>tt<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> rd <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> REDapp1 rd <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT>
        <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">Rfun fr <FONT COLOR="#000000">=</FONT> f rd</FONT> <FONT COLOR="#000000">in</FONT> fr <FONT COLOR="#000000">(</FONT>r1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">end</FONT>
      <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> REDapp2 rd <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
        <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">SN fsn1 <FONT COLOR="#000000">=</FONT> sn1</FONT>
      <FONT COLOR="#000000">in</FONT>
        cr3a <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">,</FONT> neu<FONT COLOR="#000000">,</FONT> cr2 <FONT COLOR="#000000">(</FONT>r1<FONT COLOR="#000000">,</FONT> rd<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> fsn1 rd<FONT COLOR="#000000">,</FONT> f<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> REDapp3 _ <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">begin</FONT>
        <FONT COLOR="#000000">case+</FONT> neu <FONT COLOR="#000000">of</FONT> NEUcst<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> NEUapp<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [ff]
</FONT><FONT COLOR="#000000">in</FONT>
  cr3  <FONT COLOR="#000000">(</FONT>NEUapp<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">,</FONT> ff<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [cr3a]
</FONT>
<FONT COLOR="#787878">// application reducibility lemma
</FONT>
<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">reduceFun <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm<FONT COLOR="#000000">;</FONT> t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n1+n2<FONT COLOR="#000000">&gt;.</FONT></FONT> <FONT COLOR="#000000">(</FONT>
    tp1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP T1</FONT>
  <FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP T2</FONT>
  <FONT COLOR="#000000">,</FONT> sn1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN<FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> n1<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">,</FONT> sn2<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> n2<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">,</FONT> r1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">,</FONT> fr2<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> R<FONT COLOR="#000000">(</FONT>f t<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>TMapp<FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">fr <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>red<FONT COLOR="#000000">:</FONT><FONT COLOR="#0000FF">RED0 <FONT COLOR="#000000">(</FONT>TMapp<FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> t'<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
    <FONT COLOR="#000000">case+</FONT> red <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> REDapp1<FONT COLOR="#000000">(</FONT>red'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
        <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">REDlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">,</FONT>f'<FONT COLOR="#000000">}</FONT></FONT> fred' <FONT COLOR="#000000">=</FONT> red'</FONT>
        <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">fr2' <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>f' t<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
          cr2<FONT COLOR="#000000">(</FONT>fr2 r<FONT COLOR="#000000">,</FONT> fred'<FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">)</FONT></FONT>
      <FONT COLOR="#000000">in</FONT>
        reduceFun<FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">,</FONT> forwardSN<FONT COLOR="#000000">(</FONT>sn1<FONT COLOR="#000000">,</FONT> red'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> sn2<FONT COLOR="#000000">,</FONT> r1<FONT COLOR="#000000">,</FONT> fr2'<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> REDapp2<FONT COLOR="#000000">(</FONT>red'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT>
        reduceFun<FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">,</FONT> sn1<FONT COLOR="#000000">,</FONT> forwardSN<FONT COLOR="#000000">(</FONT>sn2<FONT COLOR="#000000">,</FONT> red'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> cr2<FONT COLOR="#000000">(</FONT>r1<FONT COLOR="#000000">,</FONT> red'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> fr2<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> REDapp3 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> fr2 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>r1<FONT COLOR="#000000">)</FONT></FONT>
<FONT COLOR="#000000">in</FONT>
  cr3<FONT COLOR="#000000">(</FONT>NEUapp<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">,</FONT> fr<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [reduceFun]
</FONT>
<FONT COLOR="#787878">// the abstraction rule is sound with respect to reducible terms
</FONT><FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">absSound <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>
    tp1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP T1</FONT>
  <FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP T2</FONT>
  <FONT COLOR="#000000">,</FONT> frr<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT><FONT COLOR="#000000">fun</FONT><FONT COLOR="#000000">&gt;</FONT> R<FONT COLOR="#000000">(</FONT>f t<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> TPfun<FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">fr <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>rt<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>TMapp<FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
    <FONT COLOR="#000000">let</FONT> 
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">snt <FONT COLOR="#000000">=</FONT> cr1<FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> rt<FONT COLOR="#000000">)</FONT></FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">snf <FONT COLOR="#000000">=</FONT> lamSN <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">,</FONT>TMcst<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>cr1 <FONT COLOR="#000000">(</FONT>tp2<FONT COLOR="#000000">,</FONT> frr <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>TMcst<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>cr4 tp1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
    <FONT COLOR="#000000">in</FONT>
      reduceFun <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">,</FONT> snf<FONT COLOR="#000000">,</FONT> snt<FONT COLOR="#000000">,</FONT> rt<FONT COLOR="#000000">,</FONT> frr<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT></FONT>
<FONT COLOR="#000000">in</FONT>
  Rfun<FONT COLOR="#000000">(</FONT>fr<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [absSound]
</FONT>
<FONT COLOR="#787878">// pick specified reducibility predicate from the sequence
</FONT><FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">rGet <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>ctx<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>G<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">INCTX <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> rs<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RS G</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> rs <FONT COLOR="#000000">of</FONT> RScons<FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">,</FONT>_<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> r<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> INCTXshi i <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> rs <FONT COLOR="#000000">of</FONT> RScons<FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT>rs<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> rGet<FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">,</FONT> rs<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">// The assigned type can be extracted from a derivation
</FONT><FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">der2tp <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>ctx<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TP T</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> DERvar <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> tp
  <FONT COLOR="#000000">|</FONT> DERlam <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> derf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">tp2 <FONT COLOR="#000000">=</FONT> der2tp <FONT COLOR="#000000">(</FONT>derf <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">)</FONT></FONT>
    <FONT COLOR="#000000">in</FONT>
      TPfun <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT>tp2<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> DERapp <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT> der2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">TPfun <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> der2tp der1</FONT>
    <FONT COLOR="#000000">in</FONT>
      tp2
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [der2tp]
</FONT>
<FONT COLOR="#787878">// main lemma
</FONT><FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">reduceLemma <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>ctx<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> rs<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">RS G</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> DERvar <FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">,</FONT>_<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> rGet <FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">,</FONT> rs<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> DERlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> derf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT> 
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">TPfun <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> der2tp der</FONT>
      <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">gr <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>f t<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
        <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">rs' <FONT COLOR="#000000">=</FONT> RScons <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">,</FONT> rs<FONT COLOR="#000000">)</FONT></FONT>       
        <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">r' <FONT COLOR="#000000">=</FONT> reduceLemma <FONT COLOR="#000000">(</FONT>derf<FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">,</FONT> rs'<FONT COLOR="#000000">)</FONT></FONT>
      <FONT COLOR="#000000">in</FONT>
        r'
      <FONT COLOR="#000000">end</FONT></FONT>
      <FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">fr <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R<FONT COLOR="#000000">(</FONT>TMapp<FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>    
        <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">lamf_red <FONT COLOR="#000000">=</FONT> absSound<FONT COLOR="#000000">(</FONT>tp1<FONT COLOR="#000000">,</FONT> tp2<FONT COLOR="#000000">,</FONT> gr<FONT COLOR="#000000">)</FONT></FONT>
        <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">Rfun<FONT COLOR="#000000">(</FONT>red_imp<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> lamf_red</FONT>
      <FONT COLOR="#000000">in</FONT>
        red_imp r
      <FONT COLOR="#000000">end</FONT></FONT>
    <FONT COLOR="#000000">in</FONT>
      Rfun fr
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> DERapp <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT> der2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">r1 <FONT COLOR="#000000">=</FONT> reduceLemma<FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT> rs<FONT COLOR="#000000">)</FONT></FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">Rfun fr <FONT COLOR="#000000">=</FONT> r1</FONT>
      <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">r2 <FONT COLOR="#000000">=</FONT> reduceLemma<FONT COLOR="#000000">(</FONT>der2<FONT COLOR="#000000">,</FONT> rs<FONT COLOR="#000000">)</FONT></FONT>
    <FONT COLOR="#000000">in</FONT>
      fr r2
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [reduceLemma]
</FONT>
<FONT COLOR="#787878">// all typable terms are reducible
</FONT><FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">reduce <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER0 <FONT COLOR="#000000">(</FONT>CTXnil<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">R <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  reduceLemma<FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">,</FONT> RSnil<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">// the final payoff
</FONT><FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">normalize <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER0 <FONT COLOR="#000000">(</FONT>CTXnil<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">SN0 t</FONT> <FONT COLOR="#000000">=</FONT>
  cr1<FONT COLOR="#000000">(</FONT>der2tp der<FONT COLOR="#000000">,</FONT> reduce der<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#787878">(* end of [STLC-SN-hoas.dats] *)</FONT>
</PRE></BODY>
