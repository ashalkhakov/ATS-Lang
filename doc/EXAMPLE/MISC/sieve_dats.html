<BODY BGCOLOR="#E0E0E0" TEXT="#E80000"><PRE><FONT COLOR="#787878">(*

// Implementing Erathosthene's sieve

// author: Hongwei Xi (November, 2006)

*)</FONT>

<FONT COLOR="#787878">// lazy list:
</FONT><FONT COLOR="#000000">datatype</FONT> <FONT COLOR="#0000FF">llist</FONT> <FONT COLOR="#000000">=</FONT> lcons <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>intGte 2<FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT>cloref1<FONT COLOR="#000000">&gt;</FONT> llist<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">#define</FONT> <FONT COLOR="#800080">:: lcons</FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">fun</FONT> filter
  <FONT COLOR="#000000">(</FONT>p<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">intGte 2 <FONT COLOR="#000000">-&lt;</FONT>cloref<FONT COLOR="#000000">&gt;</FONT> bool</FONT><FONT COLOR="#000000">,</FONT> xs<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">llist</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">llist</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">val+</FONT> x :: fxs <FONT COLOR="#000000">=</FONT> xs
<FONT COLOR="#000000">in</FONT>
  <FONT COLOR="#000000">if</FONT> p <FONT COLOR="#000000">(</FONT>x<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">then</FONT> x :: <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">lam</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&lt;</FONT><FONT COLOR="#0000FF">cloref1</FONT><FONT COLOR="#000000">&gt;</FONT> filter <FONT COLOR="#000000">(</FONT>p<FONT COLOR="#000000">,</FONT> fxs <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">else</FONT> filter <FONT COLOR="#000000">(</FONT>p<FONT COLOR="#000000">,</FONT> fxs <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [filter]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">fun</FONT> sieve <FONT COLOR="#000000">(</FONT>xs<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">llist</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">llist</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">val+</FONT> x :: fxs <FONT COLOR="#000000">=</FONT> xs
<FONT COLOR="#000000">in</FONT>
  x :: <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">lam</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> sieve <FONT COLOR="#000000">(</FONT>filter <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">lam</FONT> <FONT COLOR="#000000">(</FONT>x'<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">intGte 2</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> x' nmod x &lt;&gt; 0<FONT COLOR="#000000">,</FONT> fxs <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [sieve]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">val</FONT> primes<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">llist</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">fun</FONT> aux <FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">intGte 2</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">llist</FONT> <FONT COLOR="#000000">=</FONT> i :: <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">lam</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> aux <FONT COLOR="#000000">(</FONT>i + 1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">in</FONT>
  sieve <FONT COLOR="#000000">(</FONT>aux 2<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [primes]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">fun</FONT> print_ints <FONT COLOR="#000000">(</FONT>xs<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">llist</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">val+</FONT> x :: fxs <FONT COLOR="#000000">=</FONT> xs
<FONT COLOR="#000000">in</FONT>
  print x<FONT COLOR="#000000">;</FONT> print_newline <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT> print_ints <FONT COLOR="#000000">(</FONT>fxs <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [print_ints]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">implement</FONT> main <FONT COLOR="#000000">(</FONT>argc<FONT COLOR="#000000">,</FONT> argv<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> print_ints primes

<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#787878">(* end of [sieve.dats] *)</FONT>
</PRE></BODY>
