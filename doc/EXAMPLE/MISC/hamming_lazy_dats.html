<BODY BGCOLOR="#E0E0E0" TEXT="#E80000"><PRE><FONT COLOR="#787878">(*

// solving hamming problem in lazy style

// author: Hongwei Xi (September, 2007)

*)</FONT>

<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#000000">staload</FONT> <FONT COLOR="#0000FF">"prelude/DATS/lazy.dats"</FONT>

<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#000000">#define</FONT> <FONT COLOR="#800080">nil stream_nil</FONT>
<FONT COLOR="#000000">#define</FONT> <FONT COLOR="#800080">cons stream_cons</FONT>
<FONT COLOR="#000000">#define</FONT> <FONT COLOR="#800080">:: stream_cons</FONT>

<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#000000">fn</FONT> lte <FONT COLOR="#000000">(</FONT>x<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">Nat</FONT><FONT COLOR="#000000">,</FONT> y<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">Nat</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:&lt;</FONT><FONT COLOR="#0000FF">cloptr</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#0000FF">bool</FONT> <FONT COLOR="#000000">=</FONT> x &lt;= y

<FONT COLOR="#000000">fn</FONT> scale <FONT COLOR="#000000">(</FONT>S<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">stream Nat</FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">Nat</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">stream Nat</FONT> <FONT COLOR="#000000">=</FONT>
  stream_map&lt;<FONT COLOR="#0000FF">Nat</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#0000FF">Nat</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#000000">(</FONT>S<FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">lam</FONT> x <FONT COLOR="#000000">=&gt;</FONT> n nmul x<FONT COLOR="#000000">)</FONT>

<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">rec</FONT> S<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">stream Nat</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">$delay</FONT> <FONT COLOR="#000000">(</FONT>
  1 :: stream_merge_ord <FONT COLOR="#000000">(</FONT>stream_merge_ord <FONT COLOR="#000000">(</FONT>scale <FONT COLOR="#000000">(</FONT>S<FONT COLOR="#000000">,</FONT> 2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> scale <FONT COLOR="#000000">(</FONT>S<FONT COLOR="#000000">,</FONT> 3<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> lte<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> scale <FONT COLOR="#000000">(</FONT>S<FONT COLOR="#000000">,</FONT> 5<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> lte<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">)</FONT>

<FONT COLOR="#000000">fun</FONT> remove_dup <FONT COLOR="#000000">(</FONT>S0<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">stream Nat</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">stream_con Nat</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">fun</FONT> rmv <FONT COLOR="#000000">(</FONT>n<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">Nat</FONT><FONT COLOR="#000000">,</FONT> S0<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">stream Nat</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">stream_con Nat</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
    <FONT COLOR="#000000">case+</FONT> lazy_force S0 <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> x :: S <FONT COLOR="#000000">=&gt;</FONT>
       <FONT COLOR="#000000">if</FONT> <FONT COLOR="#000000">(</FONT>n <FONT COLOR="#000000">&lt;</FONT> x<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">then</FONT> n :: <FONT COLOR="#000000">$delay</FONT> <FONT COLOR="#000000">(</FONT>rmv <FONT COLOR="#000000">(</FONT>x<FONT COLOR="#000000">,</FONT> S<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">else</FONT> rmv <FONT COLOR="#000000">(</FONT>n<FONT COLOR="#000000">,</FONT> S<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">|</FONT> nil <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> nil <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [rmv]
</FONT><FONT COLOR="#000000">in</FONT>
  <FONT COLOR="#000000">case+</FONT> lazy_force S0 <FONT COLOR="#000000">of</FONT> n :: S <FONT COLOR="#000000">=&gt;</FONT> rmv <FONT COLOR="#000000">(</FONT>n<FONT COLOR="#000000">,</FONT> S<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> nil <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> nil <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [remove_dup]
</FONT>
<FONT COLOR="#000000">val</FONT> S <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">$delay</FONT> <FONT COLOR="#000000">(</FONT>remove_dup S<FONT COLOR="#000000">)</FONT>

<FONT COLOR="#000000">implement</FONT> main <FONT COLOR="#000000">(</FONT>argc<FONT COLOR="#000000">,</FONT> argv<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>

<FONT COLOR="#000000">fun</FONT> loop<FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>S<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">stream Nat</FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int n</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  <FONT COLOR="#000000">if</FONT> n <FONT COLOR="#000000">&gt;</FONT> 0 <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> lazy_force S <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> x :: S <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT>print <FONT COLOR="#000000">(</FONT>x<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">Nat</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT> print_newline <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT> loop <FONT COLOR="#000000">(</FONT>S<FONT COLOR="#000000">,</FONT> n-1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">|</FONT> nil <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [loop]
</FONT>
<FONT COLOR="#000000">in</FONT>
  loop <FONT COLOR="#000000">(</FONT>S<FONT COLOR="#000000">,</FONT> 100<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [main]
</FONT>
<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#787878">(* end of [hamming_lazy.dats] *)</FONT>
</PRE></BODY>
