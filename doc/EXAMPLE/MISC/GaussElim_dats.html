<BODY BGCOLOR="#E0E0E0" TEXT="#E80000"><PRE><FONT COLOR="#787878">(*
 *
 * An implementation of the Gaussian elimination algorithm in ATS
 * The code is a direct translation from an earlier version written
 * in DML, the predessor of ATS.
 *
 * Hongwei Xi (January 2008)
 *
 *)</FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">staload</FONT> <FONT COLOR="#0000FF">ARR <FONT COLOR="#000000">=</FONT> "prelude/DATS/array.dats"</FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">typedef</FONT> <FONT COLOR="#0000FF">matrix <FONT COLOR="#000000">(</FONT>a<FONT COLOR="#000000">:</FONT>t@ype<FONT COLOR="#000000">,</FONT> m<FONT COLOR="#000000">:</FONT> int<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">:</FONT>int<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> array <FONT COLOR="#000000">(</FONT>array <FONT COLOR="#000000">(</FONT>a<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> m<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">fn</FONT><FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">a<FONT COLOR="#000000">:</FONT>t@ype</FONT><FONT COLOR="#000000">}</FONT> sub2 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>m<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>M<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">matrix <FONT COLOR="#000000">(</FONT>a<FONT COLOR="#000000">,</FONT> m<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">natLt m</FONT><FONT COLOR="#000000">,</FONT> j<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">natLt n</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">a</FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">val</FONT> row <FONT COLOR="#000000">=</FONT> M[<FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT> <FONT COLOR="#000000">in</FONT> row[<FONT COLOR="#009000">j</FONT><FONT COLOR="#000000">]</FONT> <FONT COLOR="#000000">end</FONT>

<FONT COLOR="#000000">fn</FONT><FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">a<FONT COLOR="#000000">:</FONT>t@ype</FONT><FONT COLOR="#000000">}</FONT> update2 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>m<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>M<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">matrix <FONT COLOR="#000000">(</FONT>a<FONT COLOR="#000000">,</FONT> m<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">natLt m</FONT><FONT COLOR="#000000">,</FONT> j<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">natLt n</FONT><FONT COLOR="#000000">,</FONT> x<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">a</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">val</FONT> row <FONT COLOR="#000000">=</FONT> M[<FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT> <FONT COLOR="#000000">in</FONT> row[<FONT COLOR="#009000">j</FONT><FONT COLOR="#000000">]</FONT> := x <FONT COLOR="#000000">end</FONT>

<FONT COLOR="#000000">overload</FONT> <FONT COLOR="#800080"><FONT COLOR="#000000">[</FONT><FONT COLOR="#000000">]</FONT> <FONT COLOR="#000000">with</FONT> sub2</FONT>
<FONT COLOR="#000000">overload</FONT> <FONT COLOR="#800080"><FONT COLOR="#000000">[</FONT><FONT COLOR="#000000">]</FONT> <FONT COLOR="#000000">with</FONT> update2</FONT>

<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#000000">fn</FONT><FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">a<FONT COLOR="#000000">:</FONT>t@ype</FONT><FONT COLOR="#000000">}</FONT> rowSwap <FONT COLOR="#000000">(</FONT>M<FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">,</FONT> j<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">val</FONT> tmp <FONT COLOR="#000000">=</FONT> M[<FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT> <FONT COLOR="#000000">in</FONT> M[<FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT> := M[<FONT COLOR="#009000">j</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">;</FONT> M[<FONT COLOR="#009000">j</FONT><FONT COLOR="#000000">]</FONT> := tmp <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">withtype</FONT> <FONT COLOR="#000000">{</FONT>m<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT>i<FONT COLOR="#000000">,</FONT>j<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> i <FONT COLOR="#000000">&lt;</FONT> m<FONT COLOR="#000000">;</FONT> j <FONT COLOR="#000000">&lt;</FONT> m<FONT COLOR="#000000">}</FONT>
  <FONT COLOR="#000000">(</FONT>matrix <FONT COLOR="#000000">(</FONT>a<FONT COLOR="#000000">,</FONT> m<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> int i<FONT COLOR="#000000">,</FONT> int j<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">-&lt;</FONT>fun1<FONT COLOR="#000000">&gt;</FONT> void

<FONT COLOR="#000000">fn</FONT> norm <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">,</FONT>i<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> i <FONT COLOR="#000000">&lt;</FONT> n<FONT COLOR="#000000">}</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">array<FONT COLOR="#000000">(</FONT>double<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int n</FONT><FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int i</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">val</FONT> x <FONT COLOR="#000000">=</FONT> r[<FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">;</FONT> <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> r[<FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT> := 1.0
  <FONT COLOR="#000000">fun</FONT> loop <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>k<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> k &lt;= n<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>k<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int k</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:&lt;</FONT><FONT COLOR="#0000FF">cloptr1</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT>
    <FONT COLOR="#000000">if</FONT> k <FONT COLOR="#000000">&lt;</FONT> n <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">(</FONT>r[<FONT COLOR="#009000">k</FONT><FONT COLOR="#000000">]</FONT> := r[<FONT COLOR="#009000">k</FONT><FONT COLOR="#000000">]</FONT> / x<FONT COLOR="#000000">;</FONT> loop <FONT COLOR="#000000">(</FONT>k+1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">else</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">in</FONT>
  loop <FONT COLOR="#000000">(</FONT>i+1<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [norm]
</FONT>
<FONT COLOR="#000000">fn</FONT> rowElim <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">,</FONT>i<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> i <FONT COLOR="#000000">&lt;</FONT> n<FONT COLOR="#000000">}</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">array<FONT COLOR="#000000">(</FONT>double<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> s<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">array<FONT COLOR="#000000">(</FONT>double<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int n</FONT><FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int i</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">val</FONT> x <FONT COLOR="#000000">=</FONT> s[<FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">;</FONT> <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> s[<FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT> := 0.0
  <FONT COLOR="#000000">fun</FONT> loop <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>k<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> k &lt;= n<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>k<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int k</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:&lt;</FONT><FONT COLOR="#0000FF">cloptr1</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT>
    <FONT COLOR="#000000">if</FONT> k <FONT COLOR="#000000">&lt;</FONT> n <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">(</FONT>s[<FONT COLOR="#009000">k</FONT><FONT COLOR="#000000">]</FONT> := s[<FONT COLOR="#009000">k</FONT><FONT COLOR="#000000">]</FONT> - x * r[<FONT COLOR="#009000">k</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">;</FONT> loop <FONT COLOR="#000000">(</FONT>k+1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">else</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">in</FONT>
  loop <FONT COLOR="#000000">(</FONT>i+1<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [rowElim]
</FONT>
<FONT COLOR="#000000">fn</FONT> rowMax <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>m<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">,</FONT>i<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> i <FONT COLOR="#000000">&lt;</FONT> m<FONT COLOR="#000000">;</FONT> i <FONT COLOR="#000000">&lt;</FONT> n<FONT COLOR="#000000">}</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>M<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">matrix <FONT COLOR="#000000">(</FONT>double<FONT COLOR="#000000">,</FONT> m<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> m<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int m</FONT><FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int i</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">natLt m</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">val</FONT> x <FONT COLOR="#000000">=</FONT> abs <FONT COLOR="#000000">(</FONT>M[<FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">fun</FONT> loop <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>j<FONT COLOR="#000000">,</FONT>max<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> max <FONT COLOR="#000000">&lt;</FONT> j<FONT COLOR="#000000">;</FONT> j &lt;= m<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>m-j<FONT COLOR="#000000">&gt;.</FONT></FONT>
    <FONT COLOR="#000000">(</FONT>j<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int j</FONT><FONT COLOR="#000000">,</FONT> x<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">double</FONT><FONT COLOR="#000000">,</FONT> max<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int max</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:&lt;</FONT><FONT COLOR="#0000FF">cloptr1</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#0000FF">natLt m</FONT> <FONT COLOR="#000000">=</FONT>
    <FONT COLOR="#000000">if</FONT> j <FONT COLOR="#000000">&lt;</FONT> m <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val</FONT> y <FONT COLOR="#000000">=</FONT> abs <FONT COLOR="#000000">(</FONT>M[<FONT COLOR="#009000">j</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
      <FONT COLOR="#000000">if</FONT> <FONT COLOR="#000000">(</FONT>y <FONT COLOR="#000000">&gt;</FONT> x<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">then</FONT> loop <FONT COLOR="#000000">(</FONT>j+1<FONT COLOR="#000000">,</FONT> y<FONT COLOR="#000000">,</FONT> j<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">else</FONT> loop <FONT COLOR="#000000">(</FONT>j+1<FONT COLOR="#000000">,</FONT> x<FONT COLOR="#000000">,</FONT> max<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT> <FONT COLOR="#000000">else</FONT> <FONT COLOR="#000000">begin</FONT>
      max <FONT COLOR="#787878">// the return value of the loop
</FONT>    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">in</FONT>
  loop <FONT COLOR="#000000">(</FONT>i + 1<FONT COLOR="#000000">,</FONT> x<FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [rowMax]
</FONT>
<FONT COLOR="#000000">fn</FONT> GaussElim <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>M<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">matrix <FONT COLOR="#000000">(</FONT>double<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int n</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">fun</FONT> loop1 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>i<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> i &lt;= n<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n-i<FONT COLOR="#000000">&gt;.</FONT></FONT> <FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int i</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">:&lt;</FONT><FONT COLOR="#0000FF">cloptr1</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
    <FONT COLOR="#000000">if</FONT> i <FONT COLOR="#000000">&lt;</FONT> n <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val</FONT> max <FONT COLOR="#000000">=</FONT> rowMax<FONT COLOR="#000000">(</FONT>M<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> norm <FONT COLOR="#000000">(</FONT>M[<FONT COLOR="#009000">max</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> rowSwap <FONT COLOR="#000000">(</FONT>M<FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">,</FONT> max<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> loop2 <FONT COLOR="#000000">(</FONT>i+1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">where</FONT> <FONT COLOR="#000000">{</FONT>
        <FONT COLOR="#000000">fun</FONT> loop2 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>j<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> j &lt;= n<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n-j<FONT COLOR="#000000">&gt;.</FONT></FONT> <FONT COLOR="#000000">(</FONT>j<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int j</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:&lt;</FONT><FONT COLOR="#0000FF">cloptr1</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT>
          <FONT COLOR="#000000">if</FONT> j <FONT COLOR="#000000">&lt;</FONT> n <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">(</FONT>rowElim <FONT COLOR="#000000">(</FONT>M[<FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">,</FONT> M[<FONT COLOR="#009000">j</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT> loop2 <FONT COLOR="#000000">(</FONT>j+1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">}</FONT> <FONT COLOR="#787878">// end of [where]
</FONT>    <FONT COLOR="#000000">in</FONT>
      loop1 <FONT COLOR="#000000">(</FONT>i+1<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [if]
</FONT>  <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [loop1]
</FONT><FONT COLOR="#000000">in</FONT>
  loop1 <FONT COLOR="#000000">(</FONT>0<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [GaussElim]
</FONT>
<FONT COLOR="#000000">fun</FONT> print_array <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">,</FONT>i<FONT COLOR="#000000">,</FONT>j<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> i &lt;= j<FONT COLOR="#000000">;</FONT> j &lt;= n<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>j-i<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>A<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">array <FONT COLOR="#000000">(</FONT>double<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int i</FONT><FONT COLOR="#000000">,</FONT> j<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int j</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">fun</FONT> loop <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>k<FONT COLOR="#000000">:</FONT>int <FONT COLOR="#000000">|</FONT> i <FONT COLOR="#000000">&lt;</FONT> k<FONT COLOR="#000000">;</FONT> k &lt;= j<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>k<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int k</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:&lt;</FONT><FONT COLOR="#0000FF">cloptr1</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT>
    <FONT COLOR="#000000">if</FONT> k <FONT COLOR="#000000">&lt;</FONT> j <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">(</FONT>print "\t"<FONT COLOR="#000000">;</FONT> print A[<FONT COLOR="#009000">k</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">;</FONT> loop <FONT COLOR="#000000">(</FONT>k+1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">else</FONT> print_newline <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">in</FONT>
  <FONT COLOR="#000000">if</FONT> i <FONT COLOR="#000000">&lt;</FONT> j <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">(</FONT>print A[<FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">;</FONT> loop <FONT COLOR="#000000">(</FONT>i+1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">else</FONT> print_newline <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [print_array]
</FONT>
<FONT COLOR="#000000">fn</FONT> print_matrix <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>m<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>M<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">matrix<FONT COLOR="#000000">(</FONT>double<FONT COLOR="#000000">,</FONT> m<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">val</FONT> m <FONT COLOR="#000000">=</FONT> length M
  <FONT COLOR="#000000">fun</FONT> loop <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>i<FONT COLOR="#000000">:</FONT>nat <FONT COLOR="#000000">|</FONT> i &lt;= m<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>m-i<FONT COLOR="#000000">&gt;.</FONT></FONT> <FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int i</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:&lt;</FONT><FONT COLOR="#0000FF">cloptr1</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT>
    <FONT COLOR="#000000">if</FONT> i <FONT COLOR="#000000">&lt;</FONT> m <FONT COLOR="#000000">then</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val</FONT> row <FONT COLOR="#000000">=</FONT> M[<FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#000000">;</FONT> <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> print_array <FONT COLOR="#000000">(</FONT>row<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">,</FONT> length row<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
      loop <FONT COLOR="#000000">(</FONT>i+1<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">in</FONT>
  loop <FONT COLOR="#000000">(</FONT>0<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [print_matrix]
</FONT>
<FONT COLOR="#787878">(* Here is a test *)</FONT>

<FONT COLOR="#000000">implement</FONT> main <FONT COLOR="#000000">(</FONT>argc<FONT COLOR="#000000">,</FONT> argv<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
<FONT COLOR="#000000">val</FONT> A0 <FONT COLOR="#000000">=</FONT> array_make_elt&lt;<FONT COLOR="#0000FF">double</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#000000">(</FONT>4<FONT COLOR="#000000">,</FONT> 0.0<FONT COLOR="#000000">)</FONT>

<FONT COLOR="#000000">val</FONT> M0<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">matrix <FONT COLOR="#000000">(</FONT>double<FONT COLOR="#000000">,</FONT> 3<FONT COLOR="#000000">,</FONT> 4<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> array_make_elt <FONT COLOR="#000000">(</FONT>3<FONT COLOR="#000000">,</FONT> A0<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">0</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">0</FONT><FONT COLOR="#000000">]</FONT> := 1.0
<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">0</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">1</FONT><FONT COLOR="#000000">]</FONT> := 1.0
<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">0</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">2</FONT><FONT COLOR="#000000">]</FONT> := 1.0
<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">0</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">3</FONT><FONT COLOR="#000000">]</FONT> := ~4.0

<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">1</FONT><FONT COLOR="#000000">]</FONT> := array_make_elt&lt;<FONT COLOR="#0000FF">double</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#000000">(</FONT>4<FONT COLOR="#000000">,</FONT> 0.0<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">1</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">0</FONT><FONT COLOR="#000000">]</FONT> := ~2.0
<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">1</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">1</FONT><FONT COLOR="#000000">]</FONT> := 3.0
<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">1</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">2</FONT><FONT COLOR="#000000">]</FONT> := 1.0
<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">1</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">3</FONT><FONT COLOR="#000000">]</FONT> := 7.0

<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">2</FONT><FONT COLOR="#000000">]</FONT> := array_make_elt&lt;<FONT COLOR="#0000FF">double</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#000000">(</FONT>4<FONT COLOR="#000000">,</FONT> 0.0<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">2</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">0</FONT><FONT COLOR="#000000">]</FONT> := 3.0
<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">2</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">1</FONT><FONT COLOR="#000000">]</FONT> := ~1.0
<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">2</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">2</FONT><FONT COLOR="#000000">]</FONT> := 2.0
<FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> M0[<FONT COLOR="#009000">2</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#009000">3</FONT><FONT COLOR="#000000">]</FONT> := 7.0

<FONT COLOR="#787878">// (-9, -8, 13) is the solution to the 1st, 2nd and 3rd variables.
</FONT>
<FONT COLOR="#000000">in</FONT>

print_matrix M0<FONT COLOR="#000000">;</FONT>
GaussElim <FONT COLOR="#000000">(</FONT>M0<FONT COLOR="#000000">,</FONT> 3<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
print_matrix M0<FONT COLOR="#000000">;</FONT>

<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [main]
</FONT>
<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#787878">(* end of [GaussElim.dats] *)</FONT>
</PRE></BODY>
