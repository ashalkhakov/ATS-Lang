<BODY BGCOLOR="#E0E0E0" TEXT="#E80000"><PRE><FONT COLOR="#787878">(*

// Implementing Erathosthene's sieve in lazy style

// author: Hongwei Xi (September, 2007)

*)</FONT>

<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#000000">staload</FONT> <FONT COLOR="#0000FF">"prelude/DATS/lazy.dats"</FONT>

<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#000000">#define</FONT> <FONT COLOR="#800080">nil stream_nil</FONT>
<FONT COLOR="#000000">#define</FONT> <FONT COLOR="#800080">:: stream_cons</FONT>

<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#000000">fun</FONT> from <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>int<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>n<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int n</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">stream <FONT COLOR="#000000">(</FONT>intGte n<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">$delay</FONT> <FONT COLOR="#000000">(</FONT>n :: from <FONT COLOR="#000000">(</FONT>n+1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">typedef</FONT> <FONT COLOR="#0000FF">Nat2 <FONT COLOR="#000000">=</FONT> intGte 2</FONT>

<FONT COLOR="#000000">fun</FONT> sieve <FONT COLOR="#000000">(</FONT>ns<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">stream Nat2</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">stream <FONT COLOR="#000000">(</FONT>Nat2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">let</FONT>
     <FONT COLOR="#000000">val-</FONT> n :: ns <FONT COLOR="#000000">=</FONT> lazy_force ns
  <FONT COLOR="#000000">in</FONT>
     <FONT COLOR="#000000">$delay</FONT> <FONT COLOR="#000000">(</FONT>n :: sieve <FONT COLOR="#000000">(</FONT>stream_filter&lt;<FONT COLOR="#0000FF">Nat2</FONT><FONT COLOR="#000000">&gt;</FONT> <FONT COLOR="#000000">(</FONT>ns<FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">lam</FONT> x <FONT COLOR="#000000">=&gt;</FONT> x nmod n <FONT COLOR="#000000">&gt;</FONT> 0<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">end</FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">val</FONT> primes<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">stream Nat2</FONT> <FONT COLOR="#000000">=</FONT> sieve <FONT COLOR="#000000">(</FONT>from 2<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">fun</FONT> prime <FONT COLOR="#000000">(</FONT>n<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">Nat</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">Nat</FONT> <FONT COLOR="#000000">=</FONT> stream_nth <FONT COLOR="#000000">(</FONT>primes<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">implement</FONT> main <FONT COLOR="#000000">(</FONT>argc<FONT COLOR="#000000">,</FONT> argv<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>

<FONT COLOR="#787878">(*
printf ("prime 1 = %i\n", @(prime 1)) ;
printf ("prime 10 = %i\n", @(prime 10)) ;
printf ("prime 100 = %i\n", @(prime 100)) ;
printf ("prime 1000 = %i\n", @(prime 1000)) ;
printf ("prime 999 = %i\n", @(prime 999)) ;
*)</FONT>

printf <FONT COLOR="#000000">(</FONT>"prime 5000 = %i\n"<FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">@(</FONT>prime 5000<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">;</FONT> <FONT COLOR="#787878">// = 48619
</FONT>printf <FONT COLOR="#000000">(</FONT>"prime 10000 = %i\n"<FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">@(</FONT>prime 10000<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">;</FONT> <FONT COLOR="#787878">// = 104743
</FONT>
<FONT COLOR="#000000">end</FONT>

<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#787878">(* end of [sieve_lazy.dats] *)</FONT>
</PRE></BODY>
